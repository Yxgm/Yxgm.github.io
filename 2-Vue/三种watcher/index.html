<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>3ç§watcher | ä¸€å®¿æ›´å_BLOG</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="ä¸€å®¿æ›´å_BLOG">
    <meta name="author" content="ç››ç¥¥ç‰">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="ä¸€å®¿æ›´å_BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/1-Css/" class="animsition-link">1-Css<small>(11)</small></a></li>
				    
				    <li><a href="/categories/1-JavaScript/" class="animsition-link">1-JavaScript<small>(14)</small></a></li>
				    
				    <li><a href="/categories/1-TypeScript/" class="animsition-link">1-TypeScript<small>(3)</small></a></li>
				    
				    <li><a href="/categories/2-React/" class="animsition-link">2-React<small>(10)</small></a></li>
				    
				    <li><a href="/categories/2-React-Hooks/" class="animsition-link">2-React_Hooks<small>(5)</small></a></li>
				    
				    <li><a href="/categories/2-Reduxå’ŒRouter/" class="animsition-link">2-Reduxå’ŒRouter<small>(9)</small></a></li>
				    
				    <li><a href="/categories/2-Vue/" class="animsition-link">2-Vue<small>(12)</small></a></li>
				    
				    <li><a href="/categories/3-Brower/" class="animsition-link">3-Brower<small>(30)</small></a></li>
				    
				    <li><a href="/categories/4-Node/" class="animsition-link">4-Node<small>(1)</small></a></li>
				    
				    <li><a href="/categories/4-Promise/" class="animsition-link">4-Promise<small>(7)</small></a></li>
				    
				    <li><a href="/categories/4-Webpack/" class="animsition-link">4-Webpack<small>(8)</small></a></li>
				    
				    <li><a href="/categories/ä¸šåŠ¡å’Œæ€æƒ³/" class="animsition-link">ä¸šåŠ¡å’Œæ€æƒ³<small>(15)</small></a></li>
				    
				    <li><a href="/categories/å‰ç«¯å¤§é¡¹/" class="animsition-link">å‰ç«¯å¤§é¡¹<small>(9)</small></a></li>
				    
				    <li><a href="/categories/åŸºç¡€è¡¥å……/" class="animsition-link">åŸºç¡€è¡¥å……<small>(5)</small></a></li>
				    
				    <li><a href="/categories/æ¡†æ¶å·®å¼‚/" class="animsition-link">æ¡†æ¶å·®å¼‚<small>(8)</small></a></li>
				    
				    <li><a href="/categories/ç®—æ³•ç›¸å…³/" class="animsition-link">ç®—æ³•ç›¸å…³<small>(10)</small></a></li>
				    
				    <li><a href="/categories/è¶…è„±é¢†æ‚Ÿ/" class="animsition-link">è¶…è„±é¢†æ‚Ÿ<small>(9)</small></a></li>
				    
				    <li><a href="/categories/é¢è¯•å¤ç›˜/" class="animsition-link">é¢è¯•å¤ç›˜<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">ä¸€å®¿æ›´å_BLOG</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2022-02-11T02:37:06.000Z" itemprop="datePublished">
          2022-02-11
      </time>
    
    
    | 
    <a href='/tags/vue/'>vue</a>,
    
    <a href='/tags/å“åº”å¼åŸç†/'>å“åº”å¼åŸç†</a>
    
    
</span>
                <h1>3ç§watcher</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h1 id="å…«è‚¡éƒ¨åˆ†"><a href="#å…«è‚¡éƒ¨åˆ†" class="headerlink" title="å…«è‚¡éƒ¨åˆ†"></a>å…«è‚¡éƒ¨åˆ†</h1><p>methods ä¸€èˆ¬ç”¨äºå°è£…ä¸€äº›è¾ƒä¸ºå¤æ‚çš„å¤„ç†é€»è¾‘ï¼ˆåŒæ­¥ã€å¼‚æ­¥ï¼‰</p>
<p>computed ä¸€èˆ¬ç”¨äºå°è£…ä¸€äº›ç®€å•çš„åŒæ­¥é€»è¾‘ï¼Œå°†ç»è¿‡å¤„ç†çš„æ•°æ®è¿”å›ï¼Œç„¶åæ˜¾ç¤ºåœ¨æ¨¡ç‰ˆä¸­ï¼Œä»¥å‡è½»æ¨¡ç‰ˆçš„é‡é‡</p>
<p>watch ä¸€èˆ¬ç”¨äºå½“éœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œ</p>
<p>methodï¼šå¯ä»¥è§¦å‘å“åº”å¼ï¼Œä½†æ˜¯æ²¡æœ‰ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨templateä¸­æ‰§è¡Œä¸€æ¬¡ï¼Œå°±ä¼šå‘ç”Ÿä¸€æ¬¡è®¡ç®—ã€‚</p>
<h2 id="computedï¼šcomputedæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å—å¤šä¸ªæ•°æ®å½±å“"><a href="#computedï¼šcomputedæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å—å¤šä¸ªæ•°æ®å½±å“" class="headerlink" title="computedï¼šcomputedæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å—å¤šä¸ªæ•°æ®å½±å“"></a>computedï¼šcomputedæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å—å¤šä¸ªæ•°æ®å½±å“</h2><p>1ã€æ”¯æŒç¼“å­˜ï¼Œåªæœ‰ä¾èµ–æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œæ‰ä¼šé‡æ–°è¿›è¡Œè®¡ç®—ï¼Œåœ¨templateä¸­æœ‰ä½¿ç”¨ï¼Œå°±ä¼šå…ˆæ‰§è¡Œã€‚</p>
<p>2ã€ä¸æ”¯æŒå¼‚æ­¥ï¼Œå½“computedå†…æœ‰å¼‚æ­¥æ“ä½œæ—¶æ— æ•ˆï¼Œæ— æ³•ç›‘å¬æ•°æ®çš„å˜åŒ–ï¼Œå› ä¸ºcomputedæœ¬æ¥å°±æ˜¯ç”¨æ¥è¿”å›è®¡ç®—åçš„å€¼å¾—ï¼Œæ˜¯éœ€è¦é©¬ä¸Šå¾—åˆ°çš„ï¼Œè€Œä¸æ˜¯è¦ç­‰ä¸€æ®µæ—¶é—´æ‰èƒ½å¾—åˆ°çš„</p>
<p>3ã€computed å±æ€§å€¼ä¼šé»˜è®¤èµ°ç¼“å­˜ï¼Œè®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜çš„ï¼Œä¹Ÿå°±æ˜¯åŸºäºdataä¸­å£°æ˜è¿‡æˆ–è€…çˆ¶ç»„ä»¶ä¼ é€’çš„propsä¸­çš„æ•°æ®é€šè¿‡è®¡ç®—å¾—åˆ°çš„å€¼</p>
<p>4ã€å¦‚æœä¸€ä¸ªå±æ€§æ˜¯ç”±å…¶ä»–å±æ€§è®¡ç®—è€Œæ¥çš„ï¼Œè¿™ä¸ªå±æ€§ä¾èµ–å…¶ä»–å±æ€§ï¼Œæ˜¯ä¸€ä¸ªå¤šå¯¹ä¸€æˆ–è€…ä¸€å¯¹ä¸€ï¼Œä¸€èˆ¬ç”¨computed</p>
<p>5ã€å¦‚æœcomputedå±æ€§å±æ€§å€¼æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šèµ°getæ–¹æ³•ï¼›å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å±æ€§çš„å±æ€§å€¼ï¼›åœ¨computedä¸­çš„ï¼Œå±æ€§éƒ½æœ‰ä¸€ä¸ªgetå’Œä¸€ä¸ªsetæ–¹æ³•ï¼Œå½“æ•°æ®å˜åŒ–æ—¶ï¼Œè°ƒç”¨setæ–¹æ³•ã€‚</p>
<p>6ã€è®¡ç®—å±æ€§çš„å‡½æ•°ä¸æ¥å—å‚æ•°</p>
<h2 id="watchï¼šwatchæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å½±å“å¤šä¸ªæ•°æ®"><a href="#watchï¼šwatchæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å½±å“å¤šä¸ªæ•°æ®" class="headerlink" title="watchï¼šwatchæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å½±å“å¤šä¸ªæ•°æ®"></a>watchï¼šwatchæ“…é•¿å¤„ç†çš„åœºæ™¯ï¼šä¸€ä¸ªæ•°æ®å½±å“å¤šä¸ªæ•°æ®</h2><p>1ã€ä¸æ”¯æŒç¼“å­˜ï¼Œå½“æ•°æ®å˜ï¼Œæ‰ä¼šè§¦å‘ç›¸åº”çš„æ“ä½œï¼›å¹¶ä¸æ˜¯ç«‹åˆ»æ‰§è¡Œã€‚</p>
<p>2ã€watchæ”¯æŒå¼‚æ­¥ï¼Œå¯ä»¥ç›‘å¬è·¯ç”±å‘ç”Ÿæ”¹å˜ã€‚</p>
<p>3ã€ç›‘å¬çš„å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æœ€æ–°çš„å€¼ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å…¥ä¹‹å‰çš„å€¼ï¼›</p>
<p>4ã€å½“ä¸€ä¸ªå±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼›ä¸€å¯¹å¤šï¼›</p>
<p>5.å½“éœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œæ—¶ï¼Œåªèƒ½é‡‡ç”¨watchã€‚</p>
<p>6ã€ç›‘å¬æ•°æ®å¿…é¡»æ˜¯dataä¸­å£°æ˜è¿‡æˆ–è€…çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„propsä¸­çš„æ•°æ®ï¼Œå½“æ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘å…¶ä»–æ“ä½œï¼Œå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š </p>
<p>immediateï¼šç»„ä»¶åŠ è½½ç«‹å³è§¦å‘å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œã€€</p>
<p>deep: æ·±åº¦ç›‘å¬ï¼Œä¸ºäº†å‘ç°å¯¹è±¡å†…éƒ¨å€¼çš„å˜åŒ–ï¼Œå¤æ‚ç±»å‹çš„æ•°æ®æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚æ•°ç»„ä¸­çš„å¯¹è±¡å†…å®¹çš„æ”¹å˜ï¼Œæ³¨æ„ç›‘å¬æ•°ç»„çš„å˜åŠ¨ä¸éœ€è¦è¿™ä¹ˆåšã€‚æ³¨æ„ï¼šdeepæ— æ³•ç›‘å¬åˆ°æ•°ç»„çš„å˜åŠ¨å’Œå¯¹è±¡çš„æ–°å¢ï¼Œå‚è€ƒvueæ•°ç»„å˜å¼‚,åªæœ‰ä»¥å“åº”å¼çš„æ–¹å¼è§¦å‘æ‰ä¼šè¢«ç›‘å¬åˆ°ã€‚</p>
<p>7.watchçš„ç›‘å¬åªèƒ½æ˜¯å•ä¸ªçš„ç›‘å¬ï¼Œæ¯æ¬¡ç›‘å¬åªèƒ½ç›‘å¬ä¸€ä¸ªå˜é‡çš„ä¿®æ”¹ï¼Œä¸èƒ½åŒæ—¶ç›‘å¬å¤šä¸ªå˜é‡çš„ä¿®æ”¹ï¼Œè®¡ç®—å±æ€§computedå¯ä»¥ä¾èµ–å¤šä¸ªæ•°æ®çš„å˜åŒ–ï¼ˆå¹¶ä¸”åªè·Ÿä»–æ‰€ä¾èµ–çš„é¡¹è¿›è¡Œå…³è”ï¼‰</p>
<h2 id="watchæºç çš„å·¥ä½œæµç¨‹"><a href="#watchæºç çš„å·¥ä½œæµç¨‹" class="headerlink" title="watchæºç çš„å·¥ä½œæµç¨‹"></a>watchæºç çš„å·¥ä½œæµç¨‹</h2><p>1.åˆå§‹åŒ–ç»„ä»¶ä¸Šé…ç½®çš„watcherå±æ€§</p>
<p>2.å¯¹watcherå±æ€§å¯èƒ½çš„å†™æ³•è¿›è¡Œè§„æ•´ï¼Œå¾—å‡ºkeyå’Œhandle</p>
<p>3.é€šè¿‡new Watcher æ¥åˆ›å»ºä¸€ä¸ªåŸºäºkeyå’Œhandleçš„è§‚å¯Ÿè€…</p>
<p>4.Watcher çš„keyä¸ºå“åº”å¼çš„vm ä¸Šçš„å˜é‡ï¼Œåœ¨watcher.getçš„æ—¶å€™ï¼Œwatcherè®¢é˜…äº†å¯¹åº”keyçš„å˜åŒ–ã€‚å®Œæˆå“åº”ä¾èµ–ã€‚</p>
<p>5.å½“keyçš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œè§¦å‘watcherçš„æ›´æ–°æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œå›è°ƒå‡½æ•°handle</p>
<h2 id="computedæºç çš„æµç¨‹"><a href="#computedæºç çš„æµç¨‹" class="headerlink" title="computedæºç çš„æµç¨‹"></a>computedæºç çš„æµç¨‹</h2><p>1.åˆå§‹åŒ–çš„æ—¶å€™ä¼šè·å–computedé‡Œçš„å®šä¹‰ã€‚</p>
<p>2.é€šè¿‡éå†ç¬¬ä¸€æ­¥çš„ç»“æœï¼ŒæŒ‰ç…§computedæ–°çš„å˜é‡åç”ŸæˆWatcherå®ä¾‹ã€‚</p>
<p>3.computedçš„watcheré»˜è®¤æ˜¯lazyæ¨¡å¼çš„ï¼Œæ‰€ä»¥new Watcher çš„æ—¶å€™ä¸ä¼šè°ƒç”¨watcherå®ä¾‹çš„getæ–¹æ³•</p>
<p>4.vue ä¸ºcomputed é‡Œçš„æ¯ä¸ªkey ä»£ç†äº†ä¸€ä¸ªæ–°çš„getæ–¹æ³•createComputedGetter()ï¼Œå½“renderé¡µé¢çš„æ—¶å€™ï¼Œæ–°çš„getè°ƒç”¨computed watcherå®ä¾‹çš„é»˜è®¤getæ–¹æ³•ã€‚</p>
<p>5.computedæ‰§è¡Œè‡ªå®šä¹‰getæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­æ˜¯å¦ä¾èµ–åˆå˜åŠ¨ï¼Œæ²¡æœ‰çš„è¯ï¼Œç›´æ¥å–å€¼ï¼Œå¦åˆ™å»æ‰§è¡Œè·å–ä¾èµ–çš„å˜é‡ã€‚</p>
<p>6.è·å–ä¾èµ–å˜é‡çš„æ—¶å€™ï¼Œå°†computedçš„watcherå®ä¾‹è®¢é˜…åˆ°ä¾èµ–çš„å˜é‡çš„Depé‡Œã€‚</p>
<p>7.èµ°å®Œè¿™ä¸€æ­¥åï¼Œå†è°ƒç”¨è®¡ç®—åˆ—çš„watcher.dependå°†ç»„ä»¶çš„watcherå®ä¾‹ä¹Ÿè®¢é˜…åˆ°è®¡ç®—åˆ—ä¾èµ–çš„æ‰€æœ‰å˜é‡çš„depä¸­ã€‚</p>
<p>8.è¿™æ ·ï¼Œå½“å˜é‡å˜åŒ–åï¼Œä¼šé€šçŸ¥computedçš„watcherå°†dirtyè®¾ç½®ä¸ºtrueï¼Œ ä»¥åŠç»„ä»¶çš„watcheræ›´æ–°domã€‚</p>
<h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>1.watcher åˆå§‹åŒ–æ˜¯ä¸æ‰§è¡Œçš„ï¼Œå¦‚æœæƒ³åˆå§‹åŒ–å°±æ‰§è¡Œçš„è¯å¯ä»¥é…ç½®immediateå±æ€§</p>
<p>2.ä¸€èˆ¬æƒ…å†µä¸è¦ç›´æ¥ä¿®æ”¹computedçš„å€¼ï¼Œä¼šæŠ¥é”™ï¼Œä¸€èˆ¬é€šè¿‡ä¸ºcomputedå±æ€§è‡ªå®šä¹‰setæ–¹æ³•ï¼Œé€šè¿‡æ”¹å˜ä¾èµ–å˜é‡æ¥æ”¹å˜computedçš„å€¼</p>
<p>3.computedçš„å±æ€§å¦‚æœä¸åŠ å…¥åœ¨domä¸­æ¸²æŸ“æ˜¯ä¸ä¼šè¢«åŠ å…¥åˆ°å“åº”ç³»ç»Ÿçš„ã€‚æ‰€ä»¥å¦‚æœåªæ˜¯æ•°æ®çš„å˜åŠ¨çš„ç›‘æ§ï¼Œä¸æ˜ å°„åˆ°domä¸Šï¼Œè¯·ä½¿ç”¨watcheræˆ–è€…å…¶ä»–æ–¹æ³•ã€‚</p>
<p>4.watcherå’Œcomputed å±æ€§å®šä¹‰çš„å‡½æ•°ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™å†…éƒ¨thisä¼šæŒ‡å‘ç»„ä»¶çš„çˆ¶ç¯å¢ƒï¼Œæ¯”å¦‚windowï¼Œå¯¼è‡´è°ƒç”¨å¤±è´¥ã€‚</p>
<h1 id="æºç éƒ¨åˆ†"><a href="#æºç éƒ¨åˆ†" class="headerlink" title="æºç éƒ¨åˆ†"></a>æºç éƒ¨åˆ†</h1><p>Vue.jsæ˜¯é‡‡ç”¨æ•°æ®åŠ«æŒç»“åˆå‘å¸ƒè®¢é˜…è€…æ¨¡å¼çš„æ–¹å¼ï¼Œé€šè¿‡Object.definePropertyï¼ˆï¼‰æ¥åŠ«æŒå„å­å±æ€§çš„setterï¼Œgettterï¼Œå½“æ•°æ®è®¿é—®æ—¶ï¼Œä¹Ÿå°±æ˜¯è§¦å‘äº†getteræ–¹æ³•ï¼Œåœ¨è°ƒåº¦ä¸­å¿ƒä¸­ï¼Œæˆ‘ä»¬æŠŠè¯¥æ•°æ®çš„å‰¯ä½œç”¨æ”¶é›†èµ·æ¥ï¼ˆä¹Ÿå°±æ˜¯è®¢é˜…è€…åœ¨è°ƒåº¦ä¸­å¿ƒè®¢é˜…ï¼‰ï¼Œä¹‹åä¸€æ—¦æ•°æ®æ”¹å˜æ—¶ï¼Œè§¦å‘setteræ–¹æ³•ï¼Œå¯¹åº”çš„depå¯¹è±¡è°ƒç”¨notifyå‡½æ•°ï¼ŒæŠŠæ‰€æœ‰çš„å‰¯ä½œç”¨å‡½æ•°éƒ½åœ¨æ‰§è¡Œä¸€éï¼Œä»æ–°æ¸²æŸ“è§†å›¾ï¼Œå°±ç›¸å½“äºè°ƒåº¦ä¸­å¿ƒå‘å¸ƒæ¶ˆæ¯ç»™è®¢é˜…è€…ï¼Œè§¦å‘å“åº”çš„ç›‘å¬æ¥æ¸²æŸ“è§†å›¾ã€‚</p>
<h2 id="é¦–å…ˆéœ€è¦äº†è§£çš„å‡ ä¸ªå¯¹è±¡"><a href="#é¦–å…ˆéœ€è¦äº†è§£çš„å‡ ä¸ªå¯¹è±¡" class="headerlink" title="é¦–å…ˆéœ€è¦äº†è§£çš„å‡ ä¸ªå¯¹è±¡"></a>é¦–å…ˆéœ€è¦äº†è§£çš„å‡ ä¸ªå¯¹è±¡</h2><ol>
<li><p><code>Observer</code>: è¿™é‡Œçš„ä¸»è¦å·¥ä½œæ˜¯é€’å½’åœ°ç›‘å¬å¯¹è±¡ä¸Šçš„æ‰€æœ‰å±æ€§ï¼Œåœ¨å±æ€§å€¼æ”¹å˜çš„æ—¶å€™ï¼Œè§¦å‘ç›¸åº”çš„<code>Watcher</code>ã€‚æˆ‘ç§°å®ƒä¸º<code>watcher Manager</code></p>
</li>
<li><p><code>Watcher</code>: è§‚å¯Ÿè€…ï¼Œå½“ç›‘å¬çš„æ•°æ®å€¼ä¿®æ”¹æ—¶ï¼Œæ‰§è¡Œå“åº”çš„å›è°ƒå‡½æ•°ï¼Œåœ¨<code>Vue</code>é‡Œé¢çš„æ›´æ–°æ¨¡æ¿å†…å®¹ã€‚</p>
</li>
<li><p><code>Dep</code>: é“¾æ¥<code>Observer</code>å’Œ<code>Watcher</code>çš„æ¡¥æ¢ï¼Œæ¯ä¸€ä¸ª<code>Observer</code>å¯¹åº”ä¸€ä¸ª<code>Dep</code>ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ï¼Œä¿å­˜ä¸è¯¥<code>Observer</code>ç›¸å…³çš„<code>Watcher</code>ã€‚<code>Dep.target</code>å…³å¥å±æ€§</p>
</li>
</ol>
<p><code>dep</code>å’Œ<code>watcher</code>æœ‰åŒå‘ç»‘å®šçš„å…³ç³»:</p>
<blockquote>
<p><code>render watcher</code>ä¸­æœ‰æ‰€æœ‰å“åº”å¼æ•°æ®çš„<code>dep</code>å¯¹è±¡ï¼›</p>
<p>è€Œæ•°æ®å¯¹åº”çš„<code>dep</code>å¯¹è±¡ä¸­ï¼Œ<code>sub</code>æ•°ç»„ä¸­æœ‰<code>render watcher</code>ï¼Œè¿˜å¯èƒ½æœ‰<code>computed watcher</code></p>
</blockquote>
<h2 id="ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µå’Œä¸€ä¸ªå…³é”®å±æ€§"><a href="#ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µå’Œä¸€ä¸ªå…³é”®å±æ€§" class="headerlink" title="ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µå’Œä¸€ä¸ªå…³é”®å±æ€§"></a>ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µå’Œä¸€ä¸ªå…³é”®å±æ€§</h2><ol>
<li><p>ä¾èµ–æ”¶é›†ï¼šè¯»å–æ•°æ®æ—¶ï¼ˆ<code>get</code>æ“ä½œï¼‰ï¼Œå°†ä¾èµ–è‡ªèº«çš„watcherå‡½æ•°ï¼ˆ<strong>æ„Ÿè§‰è¯´æˆå‰¯ä½œç”¨å‡½æ•°ä¼šæ›´å¥½ç†è§£</strong>ï¼‰æ”¶é›†åˆ°è‡ªå·±depä¸­ï¼ŒåŒæ—¶ <code>watcher </code>ä¹Ÿä¼šä¿å­˜æ‰€æœ‰ <code>watcher</code> ä¾èµ–æ•°æ®</p>
<p>ğŸ¤«ï¼šåœ¨æˆ‘çœ‹æ¥ï¼Œä¾èµ–æ”¶é›†ï¼Œæ˜¯ä¾èµ–è‡ªå·±æŠŠè‡ªå·±æ”¶é›†èµ·æ¥ï¼Œnew Watcherçš„æ—¶å€™ è§¦å‘å‡½æ•°æ‰§è¡Œæˆ–è€…è¯»å€¼ï¼Œç„¶åæŠŠè¢«æ•°æ®å½“ä½œå‰¯ä½œç”¨å‡½æ•°æ”¶é›†åˆ°è‡ªå·±depä¸­</p>
</li>
<li><p>æ´¾å‘æ›´æ–°ï¼šè®¾ç½®æ•°æ®æ—¶ï¼ˆ<code>set</code>æ“ä½œï¼‰ï¼Œå°†è‡ªèº«çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆdepä¸Šçš„subsæ•°ç»„ï¼‰å…¨éƒ¨é‡æ–°æ‰§è¡Œä¸€éï¼Œæ›´æ–°vdomæ•°æ®ï¼Œpatchç®—å‡ºæœ€å°ä¿®æ”¹èŒƒå›´ã€ä¿®æ”¹çœŸå®dom</p>
</li>
<li><p>currentWatcherï¼šå½“å‰çš„watchå‡½æ•°ï¼Œå”¯ä¸€å˜é‡ï¼Œæ˜¯å•ä¾‹çš„æ€æƒ³ä½“ç°ï¼Œä¸ºäº†ä¿è¯å½“å‰çš„watchå”¯ä¸€ï¼Œå¹¶ä¸”é¡ºåˆ©æ¨å…¥åˆ°ä¾èµ–å›è°ƒé˜Ÿåˆ—ä¸­</p>
</li>
</ol>
<blockquote>
<p>æ‰€ä»¥ï¼šæˆ‘ä»¬è¦ç¡®å®šä¸€ä¸ªå˜é‡æ˜¯æ€ä¹ˆæ”¶é›†ä¾èµ–å’Œæ´¾å‘æ›´æ–°</p>
</blockquote>
<h2 id="render-Watcher"><a href="#render-Watcher" class="headerlink" title="render Watcher"></a>render Watcher</h2><p>å‡½æ•°æ„ä¹‰ï¼š<code>render watcher</code> å³æ˜¯<code>vnode._update(vm._render())</code>ï¼Œç»„ä»¶é‡æ–°æ„æˆvdomï¼Œpatchï¼ŒæŒ‚è½½</p>
<p>åˆå§‹åŒ–ï¼š</p>
<blockquote>
<p><code>initData</code>è°ƒç”¨äº†observeå‡½æ•°ï¼Œå¹¶ä¸”æ–°å»ºobserveå¯¹è±¡ï¼ŒæŒ‚è½½dataå¯¹è±¡çš„<code>__ob__</code>å±æ€§ä¸Šï¼Œ<code>Observer</code> æ˜¯ &#96;&#96;data <code> çš„è§‚å¯Ÿè€…ï¼Œå®ä¾‹ä¸Šçš„</code>data<code>å±æ€§ï¼Œæ·»åŠ ä¸€ä¸ª</code><strong>ob</strong><code>å±æ€§ï¼Œä»£è¡¨è¯¥</code>data<code>å·²ç»è¢«</code>observe&#96;ç›‘å¬ã€‚è¿™ä¸ªæ˜¯ä¸ºdataæœåŠ¡çš„</p>
</blockquote>
<p>å‰¯ä½œç”¨å‡½æ•°æ”¶é›†é˜¶æ®µï¼šï¼ˆä¾èµ–æ”¶é›†ï¼‰</p>
<p>ä¸€é¡¿åˆå§‹åŒ–å®Œæ¯•åæ‰§è¡Œ  <code>new Watcher(vm, vm.$options.render, () =&gt; &#123;&#125;, true)</code></p>
<blockquote>
<p><code>render</code>å‡½æ•°æ‰§è¡Œï¼Œè¯»å–æ•°æ®ï¼Œåœ¨ new Watché˜¶æ®µå°±è§¦å‘renderå‡½æ•°ï¼Œåœ¨renderä¸­ï¼Œåˆå°†watcheræ”¶é›†ã€‚</p>
<p><code>all</code>çš„æ•°æ®getteræ“ä½œæ”¶é›†ä¾èµ–</p>
</blockquote>
<h2 id="user-Watcher"><a href="#user-Watcher" class="headerlink" title="user Watcher"></a>user Watcher</h2><p>å‡½æ•°æ„ä¹‰ï¼šç›¸å½“äºè‡ªå®šä¹‰çš„watcherï¼Œç›‘å¬ç›®æ ‡æ”¹å˜æ—¶ï¼Œè§¦å‘å›è°ƒï¼ˆuser watcherï¼‰</p>
<p>å‰¯ä½œç”¨å‡½æ•°æ”¶é›†é˜¶æ®µï¼šï¼ˆä¾èµ–æ”¶é›†ï¼‰ï¼š</p>
<blockquote>
<ol>
<li>å…ˆèµ°<code>$watch</code>ï¼Œååˆ° <code>new watch</code>ç›®çš„æ˜¯é…ç½®watcherï¼Œåˆå§‹åŒ–watcherï¼Œ userå±æ€§è®¾ç½®ä¸ºtrueï¼›</li>
<li><code>user watcher</code>çš„<code>option</code>é€‰é¡¹åªæœ‰<code>user</code>ä¸º<code>true</code>ï¼Œ<code>new Watch</code>ä¹‹åï¼Œä¼šèµ°<code>this.get()</code>ï¼Œå°†  **cä½ç»™user <code>Watcher</code>**ï¼Œæ¥ç€æ‰§è¡Œ this.getter.call(vm, vm) ï¼Œå¯¹ vm çš„å±æ€§è¿›è¡Œå±‚çº§è®¿é—®, è§¦å‘ data ä¸­ç›®æ ‡å±æ€§çš„ get æ–¹æ³•, è§¦å‘å±æ€§å¯¹åº”çš„ <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue/blob/2.6/src/core/observer/dep.js#L31">dep.depend</a> æ–¹æ³•, è¿›è¡Œä¾èµ–æ”¶é›†</li>
<li>åœ¨æˆ‘ä»¬å†™å®Œäº†watchç›‘å¬ï¼Œç›¸å½“äºvueä¸»åŠ¨çš„getäº†ä¸€ä¸‹ç›‘å¬çš„å±æ€§</li>
<li>âš ï¸ï¼š<strong>è¿™é‡Œ<code>user watcher</code>ä¸ä¼—ä¸åŒçš„æ˜¯è¿™é‡Œæ˜¯è¯»å€¼ï¼Œè€Œä¸æ˜¯å‡½æ•°è°ƒç”¨</strong></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> watcher = <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, expOrFn, cb, options) </span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span></span><br><span class="line">      ? <span class="literal">undefined</span></span><br><span class="line">      : <span class="variable language_">this</span>.<span class="title function_">get</span>() <span class="comment">//user watcher èµ°åè€…</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get () &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>)<span class="comment">//å‡ ç§watcherè½®ç€å cä½</span></span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">    value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm)</span><br><span class="line">    <span class="comment">//è°ƒç”¨å¯¹åº”cbï¼Œuser watcheræ˜¯éå†è¯»å€¼ï¼Œå¦å¤–ä¸¤ç§æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">    <span class="title function_">popTarget</span>()</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ã€€<code>user Watcher</code>å°±ä¼šè¢«å½“å‰å±æ€§æ”¶é›†åˆ°è‡ªå·±çš„<code>dep</code>ä¸­ï¼Œ</li>
</ol>
</blockquote>
<p>æ´¾å‘æ›´æ–°ï¼šç›‘å¬å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œuser watcheræ‰§è¡Œï¼Œ</p>
<p>å…¶ä»–çš„é…ç½®é¡¹ï¼š</p>
<ol>
<li>immediateï¼šimmediateåˆ¤æ–­ï¼Œä¸ºtrueçš„è¯ï¼ŒinvokeWithErrorHandlingæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯cbç›´æ¥æ‰§è¡Œä¸€é</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.<span class="property">immediate</span>) &#123;</span><br><span class="line">  <span class="title function_">pushTarget</span>()</span><br><span class="line">  <span class="title function_">invokeWithErrorHandling</span>(cb, vm, [watcher.<span class="property">value</span>], vm, info)</span><br><span class="line">  <span class="title function_">popTarget</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>deep :true</p>
<p>watch ä¸­è®¾ç½®æ·±å±‚ç›‘å¬, ä¼šæ‰§è¡Œ <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue/blob/edf7df0c837557dd3ea8d7b42ad8d4b21858ade0/src/core/observer/traverse.js#L14">traverse</a> å¯¹ value è¿›è¡Œæ·±åº¦è®¿é—®ï¼Œè§¦å‘æ‰€æœ‰å±æ€§çš„ get æ–¹æ³•ï¼Œå®ç°ä¾èµ–æ”¶é›†,ï¼Œæ•ˆæœå’Œ <code>parsePathå‡½æ•° </code>ä¸€è‡´ï¼ˆparsePathä¼šè¿”å›ä¸‹é¢çš„å¾ªç¯è¯»å€¼å‡½æ•°ï¼‰</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> segments = path.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; segments.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!obj) <span class="keyword">return</span></span><br><span class="line">    obj = obj[segments[i]]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="computed-Watcher"><a href="#computed-Watcher" class="headerlink" title="computed Watcher"></a>computed Watcher</h2><p>å‡½æ•°æ„ä¹‰ï¼šè®¡ç®—å±æ€§æ˜¯åŸºäºæ•°æ®çš„å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜çš„ï¼Œåªåœ¨ç›¸å…³å“åº”å¼ä¾èµ–å‘ç”Ÿæ”¹å˜æ—¶å®ƒä»¬æ‰ä¼šé‡æ–°æ±‚å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦è®¡ç®—å±æ€§ä¾èµ–çš„æ•°æ®è¿˜æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå¤šæ¬¡è®¿é—®è®¡ç®—å±æ€§ä¼šç«‹å³è¿”å›ä¹‹å‰çš„è®¡ç®—ç»“æœï¼Œè€Œä¸å¿…å†æ¬¡æ‰§è¡Œå‡½æ•°</p>
<p>è®¾è®¡åˆè¡·å°±æ˜¯ä¸ºäº†æƒ°æ€§æ±‚å€¼ã€‚æ¯”å¦‚è¯´æœ‰ä¸€ä¸ª1000çš„æ•°ç»„ã€‚ã€‚ã€‚ã€‚æˆ‘ä»¬ç¬¬ä¸€æ¬¡å·²ç»éå†è¿‡ä¸€æ¬¡äº†ï¼Œå†æ¬¡ä½¿ç”¨ï¼Œä¾èµ–æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å¿…å†éå†ä¸€éäº†ã€‚</p>
<h4 id="åˆå§‹åŒ–ï¼š"><a href="#åˆå§‹åŒ–ï¼š" class="headerlink" title="åˆå§‹åŒ–ï¼š"></a>åˆå§‹åŒ–ï¼š</h4><ol>
<li>new Watcherçš„æ—¶å€™è®¡ç®—å±æ€§çš„fnæ”¾å…¥getterï¼Œåˆå§‹åŒ–watcherçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ä¸»åŠ¨å‡ºå‘å±æ€§çš„getæ“ä½œï¼Œå³æ²¡æœ‰æ”¶é›†ä¾èµ–ã€‚ä½†æ ‡è®°ä¸Šäº†lazyæ ‡è¯†ä½ï¼Œdirtyæ ‡è¯†ä½</li>
<li>ä¹‹åå®šä¹‰vmä¸Šè¯»å–computedçš„getæ“ä½œï¼Œåˆå§‹åŒ–å®Œæ¯•</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> watchers = vm.<span class="property">_computedWatchers</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">watchers[key] = <span class="keyword">new</span> <span class="title class_">Watcher</span>( </span><br><span class="line">        vm,</span><br><span class="line">        getter || noop,       <span class="comment">//è®¡ç®—å±æ€§çš„fnæ”¾å…¥getter</span></span><br><span class="line">        noop,</span><br><span class="line">        computedWatcherOptions<span class="comment">//&#123;lazy:true&#125;</span></span><br><span class="line">      )</span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span>? <span class="attr">undefined</span>: <span class="variable language_">this</span>.<span class="title function_">get</span>()  <span class="comment">//computed watcher èµ°å‰è€…ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰ä¸»åŠ¨è§¦å‘getï¼Œlazyï¼šæ ‡è®°ä¸ºæ‡’watcher</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(vm, key, &#123;  <span class="comment">//åœ¨vmä¸ŠæŒ‚è½½computedçš„keyï¼Œå¹¶ä¸”è®¾ç½®computedçš„getå’Œset</span></span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">get</span>:  <span class="keyword">function</span> <span class="title function_">computedGetter</span> () &#123;            <span class="comment">//computedçš„getæ–¹æ³•</span></span><br><span class="line">   				  <span class="keyword">if</span> (watcher.<span class="property">dirty</span>) watcher.evaluate() <span class="comment">//dirtyå±æ€§æ ‡è®°æ„ä¹‰</span></span><br><span class="line">      			<span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) watcher.<span class="title function_">depend</span>()</span><br><span class="line">  			    <span class="keyword">return</span> watcher.<span class="property">value</span>                 <span class="comment">//return fn()ç»“æœ</span></span><br><span class="line">  &#125;ï¼Œ</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125; <span class="comment">// æš‚ä¸è€ƒè™‘setæƒ…å†µ</span></span><br><span class="line">  &#125;)                </span><br></pre></td></tr></table></figure>

<h4 id="å‰¯ä½œç”¨å‡½æ•°æ”¶é›†é˜¶æ®µï¼ˆä¾èµ–æ”¶é›†ï¼‰ï¼š"><a href="#å‰¯ä½œç”¨å‡½æ•°æ”¶é›†é˜¶æ®µï¼ˆä¾èµ–æ”¶é›†ï¼‰ï¼š" class="headerlink" title="å‰¯ä½œç”¨å‡½æ•°æ”¶é›†é˜¶æ®µï¼ˆä¾èµ–æ”¶é›†ï¼‰ï¼š"></a>å‰¯ä½œç”¨å‡½æ•°æ”¶é›†é˜¶æ®µï¼ˆä¾èµ–æ”¶é›†ï¼‰ï¼š</h4><ol>
<li><p>åœ¨é¦–æ¬¡æŒ‚è½½çš„æ—¶å€™ï¼Œåˆå§‹åŒ–äº†render watcherï¼Œ ä¹‹åè°ƒç”¨äº†this.get()æ–¹æ³•ï¼Œå…ˆrender watcher è¿›å…¥cä½ï¼Œåœ¨æ‰§è¡Œvm.update(vm.render)ï¼Œå†vm.renderæ‰§è¡Œ</p>
</li>
<li><p>renderè¿‡ç¨‹ä¸­ï¼Œè¯»å–åˆ°äº†è®¡ç®—å±æ€§ï¼Œè§¦å‘getï¼Œå³ä¸‹é¢å‡½æ•°ï¼Œä¼šæ‹¿åˆ°æˆ‘ä»¬ä¹‹å‰åˆå§‹åŒ–çš„computed watcherï¼Œè¿™æ­¥å¾ˆå…³é”®ï¼Œåç»­è¦æŠŠå®ƒæ¨å…¥cä½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> watcher = <span class="variable language_">this</span>.<span class="property">_computedWatchers</span>[key]</span><br><span class="line"><span class="comment">//å–åˆ°æˆ‘ä»¬ä¹‹å‰åˆå§‹åŒ–çš„computed watcherï¼Œè¿™ä¸ªwatcherä¸Šæœ‰computedå¯¹åº”çš„fn</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é¦–å…ˆä¼šåˆ¤æ–­dirtyæ ‡è¯†ä½ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥çš„æ—¶å€™ä¸ºtrueï¼Œç›´æ¥æ‰§è¡Œ<code>watcher.evaluate()</code>,å°±åˆå»æ‰§è¡Œwatcherçš„this.get()ï¼Œ<strong>computed watcherè¿›å…¥cä½ï¼Œæ­¤æ—¶çš„å…¨å±€watcherä¸­å·²ç»æœ‰ä¸¤ä¸ªwatcherï¼ˆcomputedï¼Œrenderï¼‰</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">watcher.evaluate()ç­‰ä»·äºä¸‹é¢</span><br><span class="line">  <span class="comment">//1. this.value = this.get()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//  get () &#123;</span></span><br><span class="line">  <span class="comment">//  pushTarget(this) //æŠŠå½“å‰çš„watcherç½®äºcä½</span></span><br><span class="line">  <span class="comment">//  const vm = this.vm</span></span><br><span class="line">  <span class="comment">//  let value = this.getter.call(vm, vm)//è°ƒç”¨updateComponentæˆ–è€…conputedå‡½æ•°</span></span><br><span class="line">  <span class="comment">//  popTarget()</span></span><br><span class="line">  <span class="comment">//  return value</span></span><br><span class="line">	<span class="comment">//  &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2. this.dirty = false</span></span><br><span class="line">  <span class="comment">//è¿™ä¸€æ­¥èµ°å®Œï¼Œå°±ä»£è¡¨æ‰€æœ‰çš„computedå‡½æ•°ä¸­çš„æ•°æ®ï¼Œéƒ½å·²ç»å°†computed watcheræ”¶é›†åˆ°è‡ªå·±çš„depä¸­äº†ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰§è¡Œè®¡ç®—å‡½æ•°ï¼ŒåŒæ—¶å†…éƒ¨è§¦å‘æ•°æ®çš„getæ“ä½œï¼Œå†…éƒ¨çš„æ•°æ®æ”¶é›†computed watcherï¼Œè¿™ä¸€æ­¥èµ°å®Œï¼Œå°±ä»£è¡¨æ‰€æœ‰çš„computedå‡½æ•°ä¸­çš„æ•°æ®ï¼Œéƒ½å·²ç»å°†computed watcheræ”¶é›†åˆ°å†…éƒ¨å±æ€§çš„depä¸­ã€‚</p>
</li>
<li><p>æ¥ç€æ‰§è¡Œ watcher.depend() ï¼Œåˆ¤æ–­å½“å‰targetStackä¸­æ˜¯å¦è¿˜æœ‰watcherï¼ˆå› ä¸ºrender watcherè¿˜åœ¨é˜Ÿåˆ—ä¹‹ä¸­ï¼‰ï¼Œå°†æ¸²æŸ“watcher æ·»åŠ åˆ°å±æ€§çš„depä¸­ï¼Œcomputed watcherå·²ç»å‡ºæ ˆï¼Œå¹¶ä¸”æŠŠtargetçš„æŒ‡å‘æ”¹ä¸ºå‰ä¸€ä¸ªwatcherï¼Œç°åœ¨render watcher åœ¨cä½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">watcher.<span class="title function_">depend</span>()</span><br><span class="line"><span class="comment">//   depend () &#123;</span></span><br><span class="line"><span class="comment">//		let i = this.deps.length</span></span><br><span class="line"><span class="comment">//    while (i--) &#123;</span></span><br><span class="line"><span class="comment">//    this.deps[i].depend()</span></span><br><span class="line"><span class="comment">//  &#125; æ‰€æœ‰computed watcherçš„ä¾èµ–æ•°æ®çš„subséƒ½æ·»åŠ ä¸Šrender watcher</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ­¤æ­¥ç›®çš„å°±æ˜¯è®¡ç®—å‡½æ•°å†…éƒ¨æ•°æ®<strong>ä¸ä»…è¦æŠŠcomputed watcher æ”¶é›†èµ·æ¥ï¼Œè¿˜éœ€è¦æŠŠrender watcheræ”¶é›†èµ·æ¥</strong></p>
</li>
</ol>
<p>dirty:æ„ä¹‰ï¼šå†æ¬¡è¯»å–åˆ°computedçš„æ—¶å€™ï¼Œè¿›å…¥åˆ¤æ–­ï¼Œå› ä¸ºdirtyåœ¨ç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™ï¼Œè®¾ç½®ä¸ºfalseï¼Œæ‰€ä»¥ç›´æ¥è¿”å›value</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">get</span>:  <span class="keyword">function</span> <span class="title function_">computedGetter</span> () &#123;            <span class="comment">//computedçš„getæ–¹æ³•</span></span><br><span class="line">			  <span class="keyword">if</span> (watcher.<span class="property">dirty</span>) watcher.evaluate() <span class="comment">//dirtyå±æ€§æ ‡è®°æ„ä¹‰</span></span><br><span class="line">  			<span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) watcher.<span class="title function_">depend</span>()</span><br><span class="line">		    <span class="keyword">return</span> watcher.<span class="property">value</span>                 <span class="comment">//return è®¡ç®—fn()ç»“æœ</span></span><br></pre></td></tr></table></figure>

<p>è®¡ç®—å±æ€§å†…éƒ¨æ•°æ®å¦‚æœå‘ç”Ÿæ›´æ–°ï¼šä¼šæŠŠ<code>this.dirty</code> è®¾ç½®æˆ <code>true</code>ï¼Œå¦‚æœæ•°æ®å˜åŒ–çš„æ—¶å€™å†æ‰§è¡Œ<code>watcher.evaluate()</code>è¿›è¡Œ<code>info</code>æ›´æ–°ï¼Œæ²¡æœ‰å˜åŒ–çš„çš„è¯<code>this.dirty</code> å°±æ˜¯<code>false</code>ï¼Œä¸ä¼šæ‰§è¡Œ<code>info</code>æ–¹æ³•ã€‚è¿™å°±æ˜¯computedç¼“å­˜æœºåˆ¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€çš„watcheræ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> targetStack = []</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">pushTarget</span> (<span class="attr">target</span>: ?<span class="title class_">Watcher</span>) &#123;</span><br><span class="line">  targetStack.<span class="title function_">push</span>(target)</span><br><span class="line">  <span class="title class_">Dep</span>.<span class="property">target</span> = target</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">popTarget</span> () &#123;</span><br><span class="line">  targetStack.<span class="title function_">pop</span>()</span><br><span class="line">  <span class="title class_">Dep</span>.<span class="property">target</span> = targetStack[targetStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2-Vue/vue%E9%AB%98%E7%BA%A7%E5%92%8C%E7%BB%86%E8%8A%82/" style="float: left;">
        â† vueé«˜çº§ç”¨æ³•å’Œç»†èŠ‚
    </a>
    
    
    <a class="pull-right" href="/2-Vue/%E6%A0%B8%E5%BF%83%E5%BA%93/">
        æ ¸å¿ƒåº“ â†’
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * æœç‹ç•…è¨€
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By ç››ç¥¥ç‰. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
