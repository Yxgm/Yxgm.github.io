<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>vue高级用法和细节 | 一宿更名_BLOG</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="一宿更名_BLOG">
    <meta name="author" content="盛祥玉">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="一宿更名_BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/1-Css/" class="animsition-link">1-Css<small>(11)</small></a></li>
				    
				    <li><a href="/categories/1-JavaScript/" class="animsition-link">1-JavaScript<small>(14)</small></a></li>
				    
				    <li><a href="/categories/1-TypeScript/" class="animsition-link">1-TypeScript<small>(3)</small></a></li>
				    
				    <li><a href="/categories/2-React/" class="animsition-link">2-React<small>(10)</small></a></li>
				    
				    <li><a href="/categories/2-React-Hooks/" class="animsition-link">2-React_Hooks<small>(5)</small></a></li>
				    
				    <li><a href="/categories/2-Redux和Router/" class="animsition-link">2-Redux和Router<small>(9)</small></a></li>
				    
				    <li><a href="/categories/2-Vue/" class="animsition-link">2-Vue<small>(12)</small></a></li>
				    
				    <li><a href="/categories/3-Brower/" class="animsition-link">3-Brower<small>(30)</small></a></li>
				    
				    <li><a href="/categories/4-Node/" class="animsition-link">4-Node<small>(1)</small></a></li>
				    
				    <li><a href="/categories/4-Promise/" class="animsition-link">4-Promise<small>(7)</small></a></li>
				    
				    <li><a href="/categories/4-Webpack/" class="animsition-link">4-Webpack<small>(8)</small></a></li>
				    
				    <li><a href="/categories/业务和思想/" class="animsition-link">业务和思想<small>(15)</small></a></li>
				    
				    <li><a href="/categories/前端大项/" class="animsition-link">前端大项<small>(9)</small></a></li>
				    
				    <li><a href="/categories/基础补充/" class="animsition-link">基础补充<small>(5)</small></a></li>
				    
				    <li><a href="/categories/框架差异/" class="animsition-link">框架差异<small>(8)</small></a></li>
				    
				    <li><a href="/categories/算法相关/" class="animsition-link">算法相关<small>(10)</small></a></li>
				    
				    <li><a href="/categories/超脱领悟/" class="animsition-link">超脱领悟<small>(9)</small></a></li>
				    
				    <li><a href="/categories/面试复盘/" class="animsition-link">面试复盘<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">一宿更名_BLOG</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2022-02-12T14:05:42.000Z" itemprop="datePublished">
          2022-02-12
      </time>
    
    
    | 
    <a href='/tags/vue/'>vue</a>,
    
    <a href='/tags/vue高级用法/'>vue高级用法</a>
    
    
</span>
                <h1>vue高级用法和细节</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h3 id="1-插槽"><a href="#1-插槽" class="headerlink" title="1. 插槽"></a>1. 插槽</h3><p>默认插槽，具名插槽：以name标识插槽的身份，从而在组件内部做到可区分，作用域插槽：外部做结构描述勾勒，内部做传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 子组件comA --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;demo&#x27;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;slot&gt;</span><br><span class="line">    &lt;slot name=&#x27;test&#x27;&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;slot name=&#x27;scopedSlots&#x27; test=&#x27;demo&#x27;&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;!-- 父组件 --&gt;</span><br><span class="line">&lt;comA&gt;</span><br><span class="line">  &lt;span&gt;这是默认插槽&lt;/span&gt;</span><br><span class="line">  &lt;template slot=&#x27;test&#x27;&gt;这是具名插槽&lt;/template&gt;</span><br><span class="line">  &lt;template slot=&#x27;scopedSlots&#x27; slot-scope=&#x27;scope&#x27;&gt;这是作用域插槽（老版）&#123;&#123;scope.test&#125;&#125;&lt;/template&gt;</span><br><span class="line">  &lt;template v-slot:scopedSlots=&#x27;scopeProps&#x27; slot-scope=&#x27;scope&#x27;&gt;这是作用域插槽（新版）&#123;&#123;scopeProps.test&#125;&#125;&lt;/template&gt;</span><br><span class="line">&lt;/comA&gt;</span><br></pre></td></tr></table></figure>

<p>插槽的本质是</p>
<p>子组件的占位符， 父组件分发内容</p>
<p>实现原理：</p>
<p><code>vue</code>组件实例化顺序为：父组件状态初始化(<code>data</code>、<code>computed</code>、<code>watch</code>…) –&gt; 模板编译 –&gt; 生成<code>render</code>方法 –&gt; 实例化渲染<code>watcher</code> –&gt; 调用<code>render</code>方法，生成<code>VNode</code> –&gt; <code>patch VNode</code>，转换为真实<code>DOM</code> –&gt; 实例化子组件 –&gt; ……重复相同的流程 –&gt; 子组件生成的真实<code>DOM</code>挂载到父组件生成的真实<code>DOM</code>上，挂载到页面中 –&gt; 移除旧节点</p>
<p>从上述流程中，可以推测出：</p>
<ol>
<li>父组件模板解析在子组件之前，所以父组件首先会获取到插槽模板内容</li>
<li>子组件模板解析在后，所以在子组件调用<code>render</code>方法生成<code>VNode</code>时，可以借助部分手段，拿到插槽的<code>VNode</code>节点</li>
<li>作用域插槽可以获取子组件内变量，因此作用域插槽的<code>VNode</code>生成，是动态的，即需要实时传入子组件的作用域<code>scope</code></li>
</ol>
<p>整个插槽的处理阶段大致分为三步：编译、生成渲染模板、生成VNode</p>
<h3 id="2-组件化"><a href="#2-组件化" class="headerlink" title="2.组件化"></a>2.组件化</h3><h6 id="1-mixin逻辑混入"><a href="#1-mixin逻辑混入" class="headerlink" title="1. mixin逻辑混入"></a>1. mixin逻辑混入</h6><p>应用： 抽离公共逻辑（逻辑相同，模板不同，可用mixin）缺点： 数据来源不明确 </p>
<p>合并策略<br>a. 递归合并（同一对象下的属性，也会合并）<br>b. data合并冲突时，以组件优先<br>c. 生命周期回调函数不会覆盖，优先级为<strong>先mixin 后组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mixins</span>: [demoMixin],</span><br><span class="line"><span class="attr">extends</span>: demoExtends,</span><br></pre></td></tr></table></figure>

<p>关于<code>Vue</code>的几种类型的合并策略：替换型、合并型、队列型、叠加型</p>
<ul>
<li>替换型策略有<code>props</code>、<code>methods</code>、<code>inject</code>、<code>computed</code>，就是将新的同名参数替代旧的参数</li>
<li>合并型策略是<code>data</code>, 通过<code>set</code>方法进行合并和重新赋值</li>
<li>队列型策略有<code>生命周期函数</code>和<code>watch</code>，原理是将函数存入一个数组，然后正序遍历依次执行</li>
<li>叠加型有<code>component</code>、<code>directives</code>、<code>filters</code>，通过原型链进行层层的叠加</li>
</ul>
<h6 id="2-继承拓展extends-逻辑拓展"><a href="#2-继承拓展extends-逻辑拓展" class="headerlink" title="2. 继承拓展extends - 逻辑拓展"></a>2. 继承拓展extends - 逻辑拓展</h6><p>应用： 拓展独立逻辑，与mixin的区别，传值mixin为数组</p>
<p>合并策略<br>a.  同mixin，也是递归合并<br>b. <strong>合并优先级 组件 &gt; mixin &gt; extends</strong><br>c.  回调优先级 extends &gt; mixin</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造一个基础的构造器，然后让vue.extend，作为一个基础的逻辑</span></span><br><span class="line"><span class="keyword">let</span> _baseOptions = &#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;<span class="keyword">return</span> &#123;<span class="attr">course</span>: <span class="string">&#x27;zhaowa&#x27;</span>,&#125;</span><br><span class="line">  created：()=&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;extend base&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BaseComponent</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(_baseOptions)<span class="comment">//返回一个基础构造器</span></span><br><span class="line"><span class="comment">// 基于_BaseComponent，再拓展逻辑</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">BaseComponent</span>(&#123; <span class="variable constant_">TODO</span>...&#125;)<span class="comment">//从预定义的配置中拓展出来一个独立的配置项，进行合并。</span></span><br><span class="line"><span class="comment">// 技巧：mergeOption`：就是将我们写的一些config，不断的merge，并且依据一定的优先级，应用方法：动态拓展，针对于不同的场景需求，去构建不同的拓展器，参数写成函数</span></span><br></pre></td></tr></table></figure>

<h6 id="3-Vue-use-插件"><a href="#3-Vue-use-插件" class="headerlink" title="3. Vue.use - 插件"></a>3. Vue.use - 插件</h6><p>​        注册外部插件，作为整体实例的补充，不会重复注册（底层是 map)，手写插件外部使用Vue.use(myPlugin, options)，默认调用的是内部的install方法</p>
<p>​        微内核：自己本身的东西很少，都是通过插件的方式（有点中间件的意思）来注入，webpack就是如此</p>
<h6 id="4-组件的高级引用"><a href="#4-组件的高级引用" class="headerlink" title="4. 组件的高级引用"></a>4. 组件的高级引用</h6><ul>
<li><ol>
<li>递归组件 - es6 vue-tree</li>
</ol>
</li>
<li><ol start="2">
<li>动态组件 - <component :is='name'/></li>
</ol>
</li>
<li><ol start="3">
<li>异步组件 - router（用到的时候在加载，懒加载），一般在大型项目中，考虑首屏渲染的加载时间，资源大小问题，需要用到的技术方案，详细api查阅文档</li>
</ol>
</li>
</ul>
<p>使用$set的时候就是数据没有被收集依赖 </p>
<h3 id="3-模版语法"><a href="#3-模版语法" class="headerlink" title="3. 模版语法"></a>3. 模版语法</h3><p>jsx 更自由的基于js书写，vue的编译路径：template-&gt;render-&gt;vm.render-&gt;vm.render() diff &#x3D;&gt; 可以使用性能优化方案，如果在vue中直接写render写法，就不会走vue的template优化，导致性能下降.</p>
<h3 id="4-teleport传送门"><a href="#4-teleport传送门" class="headerlink" title="4. teleport传送门"></a>4. teleport传送门</h3><p>​        可以让标签内的元素，挂在在to属性的制定根结点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;#other&quot;&gt;&lt;input/&gt;&lt;/teleport&gt; input元素挂载到了id=&quot;other&quot;元素下</span><br></pre></td></tr></table></figure>

<p>​        对于业务之中，我们一般把对话框，dialog等一些模态框，单独抽离成一个含<code>teleport</code>，<code>fixed</code>定位的组件，我们在某个页面使用的时候，引入<code>teleport</code>组件，和父组件交换一些状态变量，控制visiable，teleport内部使用v-show或者使用库的dialog等，同是内部提供一些插槽，暴露给父组件，自定义使用。</p>
<p>​        对网络请求的思考，多个dialog，如何封装的更加优雅，多个配置对象，搭上唯一表示字段（add， delete等等），建立字段和网络请求的映射关系，动态决定网络请求。</p>
<p>​        或者，将网络请求的button，作为插槽空，给父组件来决定。（不太合理）</p>
<p>​        完成请求之后，向外发送<code>done</code>事件，父组件响应，同时拿到子组件的延迟对象，添加then方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">let</span> defer = <span class="keyword">new</span> <span class="title class_">Deferred</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params"></span>) =&gt; defer.<span class="property">promise</span>;<span class="comment">//向外暴露的方法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sendData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    defer.<span class="title function_">resolve</span>(<span class="string">&#x27;data has successful send&#x27;</span>);</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;done&#x27;</span>);<span class="comment">//数据已经返回了， 外部响应事件seccess</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Success</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> promise = dialog.<span class="property">value</span>?.<span class="title function_">run</span>();</span><br><span class="line">  promise.<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>​        使用 vue 开发时，都是多个组件之间不断地嵌套，处理元素的样式或者层级的时候就会变得困难。如我们需要添加一个 modal 模态框或 toast 提示框，如果我们把这样的框可以从 vue 组件中剥离出来，我们样式和层级设置起来会更加简便。同样react中也有相同作用的 portal</p>
<p>​        对子组件延迟对象的解释：子组件内部维护一个defer对象（内部一个promise对象），目的让父组件拿到子组件异步返回的结果</p>
<h3 id="5-hook最佳实践"><a href="#5-hook最佳实践" class="headerlink" title="5. hook最佳实践"></a>5. hook最佳实践</h3><p>​        对于的<code>defineComponent api</code>，在<code>script</code>标签中定义组件和暴露的名字等等，<code>script setup</code>标签中定义逻辑和状态，因为是默认全部倒出，所以可以配置单独抽离hook，将统一模块的逻辑封装，在hook中，暴露想暴露的变量。</p>
<p>​        对于子组件想暴露给的方法，使用<code>defineExpose</code>暴露自己的内部变量和方法。</p>
<p>​      <code>defineProps</code>定义props类型或者默认值，<code>defineEmits</code>，向父组件发射事件（延迟对象中可用到）</p>
<h3 id="6-心智负担"><a href="#6-心智负担" class="headerlink" title="6. 心智负担"></a>6. 心智负担</h3><p>​        因为CompositionAPI完全就是按照setup只会执行一次进行设计的。带来了许多心智负担，因为我们不得不注意什么情况下数据可以解构而且还要保持数据的响应式。</p>
<p>reactive包裹的数据，在setup中导出时，数据写成嵌套，将会导致响应式丢失。是因为setup只会执行一次，如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="title function_">reactive</span>(&#123; count：<span class="number">0</span> ,....&#125;)；</span><br><span class="line"><span class="keyword">return</span> &#123;count : data.<span class="property">count</span>&#125;;<span class="comment">//导致count响应式丢失</span></span><br><span class="line"><span class="keyword">return</span> &#123; ...<span class="title function_">toRefs</span>(data) &#125;; <span class="comment">//对于不复杂的数据如此使用即可</span></span><br></pre></td></tr></table></figure>

<h5 id="迁移到新的心智模型"><a href="#迁移到新的心智模型" class="headerlink" title="迁移到新的心智模型"></a>迁移到新的心智模型</h5><p>​        时刻记住setup只会执行一次、永远不要直接使用简单类型、解构可能有风险，优先使用引用本身，而不是解构它、可以通过一些手段让解构变得安全</p>
<p>解决办法： </p>
<ol>
<li>优先使用引用的本身，而不是解构它</li>
<li>使用computed包裹</li>
<li>toRefs包裹。深层响应式 <code>return &#123; ...toRefs(data) &#125;</code></li>
<li>使用JSX或h的时候，setup需要返回一个函数，这个函数其实就是render函数，它在数据变化时会重新执行，所以我们只需要把解构的逻辑放到render函数里，那么就解决了setup只会执行一次的问题。</li>
</ol>
<blockquote>
<p>建议：使用自定义hooks返回数据的时候，如果数据的层级比较简单，可以直接使用toRefs包裹；如果数据的层级比较复杂，建议使用computed。</p>
</blockquote>
<h3 id="7-版本的细节区别"><a href="#7-版本的细节区别" class="headerlink" title="7. 版本的细节区别"></a>7. 版本的细节区别</h3><ol>
<li><p>Vue2中一个组件template中必须有一个根节点，Vue3可以多个</p>
</li>
<li><p>v-if和v-for的优先级：</p>
<p>vue2中v-for优先级更高，所以浪费内存（vdom先创建，后销毁）</p>
<p>vue3中调整了优先级if更高了</p>
</li>
<li><p><code>vue3</code>中的响应组合<code>api</code></p>
<ol>
<li><p><code>reactive</code>：参数是对象，因为是要对对象做代理，而<code>ref</code>多用一般数据类型</p>
</li>
<li><p><code>shallowReactive</code> 只有第一层是响应式</p>
</li>
<li><p>从<code>reactive</code>对象中解构取值时，取出的不是响应式，需要<code>toRefs</code>包裹变成响应式</p>
</li>
<li><p>effect：effect包裹的函数中响应式数据，数据变化的时候，执行函数（用于只关注更新后的值）</p>
<p><strong><code>effect</code>和react中的useEffect钩子有点类似</strong>，在组件初始化执行，vue对effect的参数（watcher函数进行收集）</p>
</li>
<li><p>watch：第一个参数写成函数的时候，只有函数的返回值变了，才会执行回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span>&gt; <span class="number">5</span>, <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="title function_">alert</span>(value) )</span><br></pre></td></tr></table></figure>

<p>count为6的时候才会执行，之后不再执行，因为返回值的状态<code>false =&gt; true </code></p>
</li>
<li><p>watchEffect和effect类似，watchEffect支持配置</p>
</li>
<li><p>provide传递的值应该会只读的，只能通过父组件传递的方法，改变数据（和redux的connect差不多从父组件传递state和dispatch）</p>
</li>
<li><p>逻辑复用vue2中使用mixin但是无法明确数据源，vue3直接使用hook即可复用</p>
</li>
</ol>
</li>
<li><p>组件是拓展的vue构造器，拓展的含义使用一些属性，方法，钩子函数，style作用域id等等来定制Vue构造器。</p>
</li>
<li><p>vue组件实例不一定是vue实例，因为可以使用vue实例作为一个EventBus来使用。</p>
<p>a.<code>Vue.extend(options)</code>：创建一个新的构造函数<br>b.<code>Vue.component(options)</code>：用来注册全局组件</p>
</li>
</ol>
<h3 id="8-attr和props"><a href="#8-attr和props" class="headerlink" title="8. $attr和props"></a>8. $attr和props</h3><ol>
<li>atrrs不需要声明就可以得到传的值，可以拿到所有的父组件传给子组件的属性和方法。</li>
<li>props声明后得到的值不再出现在atrrs中。</li>
<li>又由于props不能声明事件，得到第三个结论，attrs包含事件，props不包含。</li>
<li>为什么要区分attrs和props，是让子组件区别属性和回调函数，开闭原则的体现。</li>
</ol>
<h3 id="attrs和-listeners-祖父组件和孙组件数据传递"><a href="#attrs和-listeners-祖父组件和孙组件数据传递" class="headerlink" title="$attrs和$listeners 祖父组件和孙组件数据传递"></a>$attrs和$listeners 祖父组件和孙组件数据传递</h3><p>祖父组件正常传入props，在父组件中</p>
<p>孙子组件触发事件，emit出去事件，父组件响应 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;grand-parent @&gt; &lt;/grand-parent&gt;</span><br><span class="line">&lt;parent v-bind=&quot;$attrs&quot; v-on=&quot;$listeners&quot;&gt;&lt;/parent&gt; $attrs将属性传递下去，并且监听传入的事件</span><br><span class="line">&lt;child @click=&quot;emitCallback&quot;&gt;&lt;/child&gt; emitCallback=()=&gt;this.emit(start,data)</span><br></pre></td></tr></table></figure>

<p>privide和inject也可用于祖父和孙组件的数据传递</p>
<h3 id="修饰符："><a href="#修饰符：" class="headerlink" title="修饰符："></a>修饰符：</h3><p>stop prevent，事件修饰符</p>
<h3 id="9-创建复杂对象的响应式对象的时候，跳过对象中的一些嵌套对象的创建响应式过程"><a href="#9-创建复杂对象的响应式对象的时候，跳过对象中的一些嵌套对象的创建响应式过程" class="headerlink" title="9. 创建复杂对象的响应式对象的时候，跳过对象中的一些嵌套对象的创建响应式过程"></a>9. 创建复杂对象的响应式对象的时候，跳过对象中的一些嵌套对象的创建响应式过程</h3><p>如果我们需要跳过创建响应式对象的过程，则必须让 <code>target</code> 满足 <code>value[ReactiveFlags.SKIP] || !Object.isExtensible(value)</code> 或者命中 <code>targetTypeMap</code> 函数中的 <code>default</code> 逻辑。</p>
<p>所以说对某个嵌套对象，使用Object.freeze()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;盛祥玉&#x27;</span>, <span class="attr">height</span>: <span class="number">1.8</span>, <span class="attr">like</span>: <span class="string">&#x27;running&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> obj1 = <span class="title class_">Object</span>.<span class="title function_">freeze</span>(obj);</span><br><span class="line"><span class="comment">//obj1===obj true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">isExtensible</span>(obj)); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>


            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/3-Brower/%E5%86%85%E6%A0%B8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6%EF%BC%88%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%EF%BC%89/" style="float: left;">
        ← 内核渲染机制（进程、线程）
    </a>
    
    
    <a class="pull-right" href="/2-Vue/%E4%B8%89%E7%A7%8Dwatcher/">
        3种watcher →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 盛祥玉. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
