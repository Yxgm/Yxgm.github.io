<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>单线程、多线程（worker） | 一宿更名_BLOG</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="一宿更名_BLOG">
    <meta name="author" content="盛祥玉">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="一宿更名_BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/1-Css/" class="animsition-link">1-Css<small>(11)</small></a></li>
				    
				    <li><a href="/categories/1-JavaScript/" class="animsition-link">1-JavaScript<small>(14)</small></a></li>
				    
				    <li><a href="/categories/1-TypeScript/" class="animsition-link">1-TypeScript<small>(3)</small></a></li>
				    
				    <li><a href="/categories/2-React/" class="animsition-link">2-React<small>(10)</small></a></li>
				    
				    <li><a href="/categories/2-React-Hooks/" class="animsition-link">2-React_Hooks<small>(5)</small></a></li>
				    
				    <li><a href="/categories/2-Redux和Router/" class="animsition-link">2-Redux和Router<small>(9)</small></a></li>
				    
				    <li><a href="/categories/2-Vue/" class="animsition-link">2-Vue<small>(12)</small></a></li>
				    
				    <li><a href="/categories/3-Brower/" class="animsition-link">3-Brower<small>(30)</small></a></li>
				    
				    <li><a href="/categories/4-Node/" class="animsition-link">4-Node<small>(1)</small></a></li>
				    
				    <li><a href="/categories/4-Promise/" class="animsition-link">4-Promise<small>(7)</small></a></li>
				    
				    <li><a href="/categories/4-Webpack/" class="animsition-link">4-Webpack<small>(8)</small></a></li>
				    
				    <li><a href="/categories/业务和思想/" class="animsition-link">业务和思想<small>(15)</small></a></li>
				    
				    <li><a href="/categories/前端大项/" class="animsition-link">前端大项<small>(9)</small></a></li>
				    
				    <li><a href="/categories/基础补充/" class="animsition-link">基础补充<small>(5)</small></a></li>
				    
				    <li><a href="/categories/框架差异/" class="animsition-link">框架差异<small>(8)</small></a></li>
				    
				    <li><a href="/categories/算法相关/" class="animsition-link">算法相关<small>(10)</small></a></li>
				    
				    <li><a href="/categories/超脱领悟/" class="animsition-link">超脱领悟<small>(9)</small></a></li>
				    
				    <li><a href="/categories/面试复盘/" class="animsition-link">面试复盘<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">一宿更名_BLOG</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2022-09-01T08:20:13.694Z" itemprop="datePublished">
          2022-09-01
      </time>
    
    
    | 
    <a href='/tags/js/'>js</a>
    
    
</span>
                <h1>单线程、多线程（worker）</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="一、js的单线程机制"><a href="#一、js的单线程机制" class="headerlink" title="一、js的单线程机制"></a>一、js的单线程机制</h2><p>Javascript 这门脚本语言诞生的使命所致!JavaScript 为处理页面中用户的交互,以及操作 DOM 树、CSS 样式树来给用户呈现一份动态而丰富的交互体验和服务器逻辑的交互处理。</p>
<p>如果 JavaScript 是多线程的方式来操作这些 UI DOM,则可能出现 UI 操作的冲突。</p>
<p>如果 Javascript 是多线程的话,在多线程的交互下,处于 UI 中的 DOM 节点就可能成为一个临界资源,</p>
<p>假设存在两个线程同时操作一个 DOM,一个负责修改一个负责删除,那么这个时候就需要浏览器来裁决如何生效哪个线程的执行结果。</p>
<p>当然我们可以通过锁来解决上面的问题。但为了避免因为引入了锁而带来更大的复杂性,Javascript 在最初就选择了单线程执行，同时单线程虽然保证了dom的唯一性，但是在大量计算下，会让主线程卡顿。</p>
<blockquote>
<p>并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔内发生</p>
</blockquote>
<h2 id="二、减少主线程卡顿的方法一般来说两种方案：worker和逻辑异步化，worker是重点我们详细说说"><a href="#二、减少主线程卡顿的方法一般来说两种方案：worker和逻辑异步化，worker是重点我们详细说说" class="headerlink" title="二、减少主线程卡顿的方法一般来说两种方案：worker和逻辑异步化，worker是重点我们详细说说"></a>二、减少主线程卡顿的方法一般来说两种方案：worker和逻辑异步化，worker是重点我们详细说说</h2><h3 id="1-逻辑异步化"><a href="#1-逻辑异步化" class="headerlink" title="1. 逻辑异步化"></a>1. 逻辑异步化</h3><p>比如说播放动画，将同步任务拆分为为多个小于16ms的子任务，通过每一帧的raquestAnimationFrame，或者requestIdleCallback（MessageChannel + raquestAnimationFrame ）浏览器空闲时间，执行子任务，直到完毕。（这让我联想到了react的fiber设计心智）</p>
<p>但是逻辑异步化是有一定的限时场景的，但并不是一劳永逸的银弹，有下面几个问题</p>
<ul>
<li><strong>不是所有 JS 逻辑都可拆分.</strong> 比如数组排序, 树的递归查找, 图像处理算法等, 执行中需要维护当前状态, 且调用上非线性, 无法轻易地拆分为子任务.</li>
<li><strong>可以拆分的逻辑难以把控粒度.</strong> 如下图所示, 拆分的子任务在高性能机器 (iphoneX) 上可以控制在 16ms 内, 但在性能落后机器 (iphone6) 上就超过了 deadline. 16ms 的用户感知时间, 并不会因为用户手上机器的差别而变化, Google 给出的建议是<a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution#reduce_complexity_or_use_web_workers">再拆小到 3-4ms</a>.</li>
<li><strong>拆分的子任务并不稳定.</strong> 对同步 JS 逻辑的拆分, 需要根据业务场景寻找原子逻辑, 而原子逻辑会跟随业务变化, 每次改动业务都需要去 review 原子逻辑.</li>
</ul>
<h3 id="2-worker"><a href="#2-worker" class="headerlink" title="2. worker"></a>2. worker</h3><p>worker的多线程能力，使同步的js任务拆分一步到位，从宏观上将整个同步的js任务异步化，逻辑异步化的设计上也更加简单和可维护。</p>
<p>这给我们带来更多的想象空间. 如下图所示, 在浏览器主线程渲染周期内, 将可能阻塞页面渲染的 JS 运行任务 (Jank Job) 迁移到 Worker 线程中, 进而减少主线程的负担, 缩短渲染间隔, 减少页面卡顿.</p>
<img src="../assets/thread.jpg" style="margin:0 auto">

<h2 id="三、worker提升性能了么"><a href="#三、worker提升性能了么" class="headerlink" title="三、worker提升性能了么"></a>三、worker提升性能了么</h2><p>worker多线程并不会直接带来计算性能提升，能不能提升与设备CPU核数和线程策略有关</p>
<h3 id="1-多线程和CPU核数"><a href="#1-多线程和CPU核数" class="headerlink" title="1. 多线程和CPU核数"></a>1. 多线程和CPU核数</h3><p>在页面上运用多线程技术时, 核数会影响线程创建策略.</p>
<p>进程是操作系统<strong>资源分配</strong>的基本单位，线程是操作系统<strong>调度 CPU</strong> 的基本单位. 操作系统对线程能占用的 CPU 计算资源有<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97071815">复杂的分配策略</a>. 如下图所示:</p>
<ul>
<li>单核多线程通过时间切片交替执行.</li>
<li>多核多线程可在不同核中真正并行.</li>
</ul>
<img src="../assets/thread2.jpg" style="margin:0 auto">

<h3 id="2-worker的线程策略"><a href="#2-worker的线程策略" class="headerlink" title="2. worker的线程策略"></a>2. worker的线程策略</h3><p>一台设备上相同任务在各个线程中运行耗时是一样的，我们把主线程的任务交给新建worker线程，任务在worker上运行并不会比主线程运行的更快，而线程的创建和通信开销可能会使渲染间隔可能变得更久。</p>
<p>在单核机器上, <strong>计算资源是内卷的</strong>, 新建的 Worker 线程并不能为页面争取到更多的计算资源. 在多核机器上, 新建的 Worker 线程和主线程都能做运算, <strong>页面总计算资源增多</strong>, 但对单次任务来说, 在哪个线程上运行耗时是一样的.</p>
<p>真正带来性能提升的是**多核多线程并发.**如多个没有依赖关系的同步任务, 在单线程上只能串行执行, 在多核多线程中可以并行执行. </p>
<h2 id="四、worker设计思想"><a href="#四、worker设计思想" class="headerlink" title="四、worker设计思想"></a>四、worker设计思想</h2><p>worker的应用场景，本质上从主线程中剥离逻辑，让主线程专注于UI渲染，这种架构的设计并非web技术上的独创。</p>
<p>Android和IOS的原生开发，主线程负责UI的工作；前端的小程序，实现原理上就是渲染和逻辑的完全分离。</p>
<h2 id="五、worker运行环境"><a href="#五、worker运行环境" class="headerlink" title="五、worker运行环境"></a>五、worker运行环境</h2><p>​    在 Worker 线程中运行 JS, 会创建<strong>独立于主线程的 JS 运行环境</strong>, 称之为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope">DedicatedWorkerGlobalScope</a>. 开发者需关注 Worker 环境和主线程环境的异同, 以及 Worker 在不同浏览器上的差异.</p>
<p>​    Worker 是无 UI 的线程, 无法调用 UI 相关的 DOM&#x2F;BOM API. Worker 具体支持的 API 可参考 MDN 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Functions_and_classes_available_to_workers">functions and classes available to workers</a></p>
<img src="../assets/worker环境.jpg" style="margin:0 auto;width:60%">

<p>上图展示了 Worker 线程与主线程的异同点. Worker 运行环境与主线程的共同点主要包括:</p>
<ul>
<li>包含完整的 JS 运行时, 支持 ECMAScript 规范定义的语言语法和内置对象.</li>
<li>支持 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XmlHttpRequest</a>, 能独立发送网络请求与后台交互.</li>
<li>包含<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerLocation">只读的 Location</a>, 指向 Worker 线程执行的 script url, 可通过 url 传递参数给 Worker 环境.</li>
<li>包含<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerNavigator">只读的 Navigator</a>, 用于获取浏览器信息, 如通过 <code>Navigator.userAgent</code> 识别浏览器.</li>
<li>支持 setTimeout &#x2F; setInterval 计时器, 可用于实现异步逻辑.</li>
<li>支持 WebSocket 进行网络 I&#x2F;O; 支持 IndexedDB 进行文件 I&#x2F;O.</li>
</ul>
<p>从共同点上看, Worker 线程其实很强大, 除了利用独立线程执行重度逻辑外, 其网络 I&#x2F;O 和文件 I&#x2F;O 能力给业务和技术方案带来很大的想象空间.</p>
<p>另一方面, Worker 线程运行环境和主线程的差异点有:</p>
<ul>
<li>Worker 线程没有 DOM API, 无法新建和操作 DOM; 也无法访问到主线程的 DOM Element.</li>
<li>Worker 线程和主线程间内存独立, Worker 线程无法访问页面上的全局变量 (window, document 等) 和 JS 函数.</li>
<li>Worker 线程不能调用 alert() 或 confirm() 等 UI 相关的 BOM API.</li>
<li>Worker 线程被主线程控制, 主线程可以新建和销毁 Worker.</li>
<li>Worker 线程可以通过 <code>self.close</code> 自行销毁.</li>
</ul>
<p>从差异点上看, Worker 线程无法染指 UI, 并受主线程控制, 适合默默干活.</p>
<p>​    Worker 在不同浏览器上的差异，各家浏览器实现 Worker 规范有差异, 对比主线程, 部分 API 功能不完备, 如:IE10 发送的 AJAX 请求没有 referer, 请求可能被后台服务器拒绝.Edge18 上字符编码&#x2F; Buffer 的实现有问题.</p>
<p>​    好在这种场景并不多. 并且可以在运行时通过错误监控发现问题, 并定位和修复 (polyfill).另一方面, 一些新增的 HTML 规范 API 只在较新的浏览器上实现, Worker 运行环境甚至主线程上没有, 使用 Worker 时需判断和兼容.</p>
<h2 id="六、worker通信速度"><a href="#六、worker通信速度" class="headerlink" title="六、worker通信速度"></a>六、worker通信速度</h2><p>​    worker多线程虽然实现了js任务的并行运行，也带来了额外的通信开销，线程ApostMessage到线程Bonmessage接受是有时间差的，这段时间差为通信消耗，</p>
<p>​    我们所做的性能提升 &#x3D; 并行提升的性能 - 通信消耗的性能，在线程计算能力固定的情况下, 要通过多线程提升更多性能, 需要尽量<strong>减少通信消耗</strong>.而且主线程 postMessage 会占用主线程同步执行, <strong>占用时间与数据传输方式和数据规模相关</strong>. 要避免多线程通信导致的主线程卡顿, 需选择合适的传输方式, 并控制每个渲染周期内的数据传输规模.</p>
<h3 id="数据传输方式"><a href="#数据传输方式" class="headerlink" title="数据传输方式"></a>数据传输方式</h3><p>​    我们先来聊聊主线程和 Worker 线程的数据传输方式. 根据计算机进程模型, 主线程和 Worker 线程属于同一进程, 可以访问和操作进程的内存空间. 但为了降低多线程并发的逻辑复杂度, 部分传输方式直接隔离了线程间的内存, 相当于默认加了锁.</p>
<p>通信方式有 3 种: Structured Clone, Transfer Memory 和 Shared Array Buffer.</p>
<h4 id="1-Structured-Clone"><a href="#1-Structured-Clone" class="headerlink" title="1. Structured Clone"></a>1. Structured Clone</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">Structured Clone</a> 是 postMessage 默认的通信方式. 如下图所示, 复制一份线程 A 的 JS Object 内存给到线程 B, 线程 B 能获取和操作新复制的内存.</p>
<img src="https://camo.githubusercontent.com/87f6181bb5def94c367b6bfd117f8656d6529e42679ea82100f63b0526cc3ea6/687474703a2f2f616c6c6f797465616d2e636f6d2f77702d636f6e74656e742f75706c6f6164732f323032302f30372f737472756374757265642d636c6f6e652e6a7067" alt="img" style="zoom:33%;margin:0 auto" />

<p>Structured Clone 通过复制内存的方式简单有效地隔离不同线程内存, 避免冲突; 且传输的 Object 数据结构很灵活. 但复制过程中, 线程 A 要<strong>同步执行</strong> Object Serialization, 线程 B 要<strong>同步执行</strong> Object Deserialization; 如果 Object 规模过大, 会占用大量的线程时间.</p>
<h4 id="2-Transfer-Memory"><a href="#2-Transfer-Memory" class="headerlink" title="2. Transfer Memory"></a>2. Transfer Memory</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Transferable">Transfer Memory</a> 意为转移内存, 它不需要 Serialization&#x2F;Deserialization, 能大大减少传输过程占用的线程时间. 如下图所示 , 线程 A 将指定内存的所有权和操作权转给线程 B, 但转让后线程 A 无法再访问这块内存.</p>
<img src="https://camo.githubusercontent.com/5425eefddd892400379691d83176fcdce648b4b67c9f128df6845012edf210d5/68747470733a2f2f636e746368656e2e6769746875622e696f2f696d672f776f726b65722d7265766965772f7472616e736665722d6d656d6f72792e6a7067" alt="img" style="zoom:33%;margin:0 auto" />

<p>Transfer Memory <strong>以失去控制权来换取高效传输</strong>, 通过内存独占给多线程并发加锁. 但只能转让 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a> 等大小规整的二进制 (Raw Binary) 数据; 对矩阵数据 (如 RGB 图片) 比较适用. 实践上也要考虑从 JS Object 生成二进制数据的运算成本.</p>
<h4 id="3-Shared-Array-Buffers"><a href="#3-Shared-Array-Buffers" class="headerlink" title="3. Shared Array Buffers"></a>3. Shared Array Buffers</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer">Shared Array Buffer</a> 是共享内存, 线程 A 和线程 B 可以<strong>同时访问和操作</strong>同一块内存空间. 数据都共享了, 也就没有传输什么事了.</p>
<img src="https://camo.githubusercontent.com/5fce2b36f0175a38c97875d9ba2fe4670a296317e2fbba44e8898c12db09a6ab/687474703a2f2f616c6c6f797465616d2e636f6d2f77702d636f6e74656e742f75706c6f6164732f323032302f30372f7368617265642d61727261792d6275666665722e6a7067" alt="img" style="zoom:33%;margin:0 auto" />

<p>但多个并行的线程共享内存, 会产生竞争问题 (Race Conditions). 不像前 2 种传输方式默认加锁, Shared Array Buffers 把难题抛给开发者, 开发者可以用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics">Atomics</a> 来维护这块共享的内存. 作为较新的传输方式, 浏览器兼容性可想而知, 目前<a target="_blank" rel="noopener" href="https://caniuse.com/#search=sharedarray">只有 Chrome 68+ 支持</a>.</p>
<h4 id="传输方式小结"><a href="#传输方式小结" class="headerlink" title="传输方式小结"></a>传输方式小结</h4><ul>
<li><strong>全浏览器兼容的 Structured Clone 是较好的选择</strong>, 但要考虑数据传输规模, 下文我们会详细展开.</li>
<li>Transfer Memory 的兼容性也不错 (IE11+), 但数据独占和数据类型的限制, 使得它是特定场景的最优解, 不是通用解;</li>
<li>Shared Array Buffers 当下糟糕的兼容性和线程锁的开发成本, 建议先暗中观察.</li>
</ul>
<h4 id="structured-clone方式使用序列化更快么"><a href="#structured-clone方式使用序列化更快么" class="headerlink" title="structured clone方式使用序列化更快么"></a>structured clone方式使用序列化更快么</h4><p>​    2020 年的当下, <strong>不需要再使用 JSON.stringify</strong>. 其一是 Structured Clone 内置的 serialize&#x2F;deserialize 比 JSON.stringify 性能更高; 其二是 JSON.stringify 只适合序列化基本数据类型, 而 Structured Clone 还支持复制其他内置数据类型 (如 Map, Blob, RegExp 等, 虽然大部分应用场景只用到基本数据类型).</p>
<h2 id="七、worker要考虑的度量，如何衡量worker是否有价值？"><a href="#七、worker要考虑的度量，如何衡量worker是否有价值？" class="headerlink" title="七、worker要考虑的度量，如何衡量worker是否有价值？"></a>七、worker要考虑的度量，如何衡量worker是否有价值？</h2><p>​    一般来说worker的应用场景在于减少主线程的卡顿，可能会带来性能的提升，大量的js计算放在web worker中执行，那么这个大量的计算的度量是如何的呢，这个度量又依赖什么因素呢？我们如何衡量一个worker是否有价值？</p>
<p>根据 Chrome 团队提出的用户感知性能模型 <a target="_blank" rel="noopener" href="https://web.dev/rail/">RAIL</a>, 同步 JS 执行时间不能过长. 量化来说下面几点：</p>
<ol>
<li>播放动画时建议小于 16ms，当一帧的时间过长，就应该用worker来处理主线程中的js计算了；</li>
<li>用户操作响应建议小于 100ms，这一点也是页面假死问题；</li>
<li>页面打开到开始呈现内容建议小于 1000ms；</li>
</ol>
<p>而导致这些问题的因素就是大量的js运行计算，比如大量的网络IO、大量节点的diff计算等等</p>
<p>​    最后来说我们需要一些工具，来测试使用的worker是否真正提高了性能（比如说页面的帧数比以前更流程，打开页面速度更快，用户触发响应事件更快），我们所做的性能提升 &#x3D; 并行提升的性能 - 通信消耗的性能 &gt; 原来没有引入worker的性能，所做的worker性能提升才是意义的。</p>
<h2 id="八、web-worker综述：https-github-com-Bulandent-blog-issues-19"><a href="#八、web-worker综述：https-github-com-Bulandent-blog-issues-19" class="headerlink" title="八、web worker综述：https://github.com/Bulandent/blog/issues/19"></a>八、web worker综述：<a target="_blank" rel="noopener" href="https://github.com/Bulandent/blog/issues/19">https://github.com/Bulandent/blog/issues/19</a></h2>
            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2-Vue/state%20change/" style="float: left;">
        ← state change
    </a>
    
    
    <a class="pull-right" href="/1-JavaScript/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E6%80%9D%E8%80%83/">
        深拷贝的思考 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 盛祥玉. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
