<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>http报文，请求中断 | 一宿更名_BLOG</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="一宿更名_BLOG">
    <meta name="author" content="盛祥玉">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="一宿更名_BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/1-Css/" class="animsition-link">1-Css<small>(11)</small></a></li>
				    
				    <li><a href="/categories/1-JavaScript/" class="animsition-link">1-JavaScript<small>(14)</small></a></li>
				    
				    <li><a href="/categories/1-TypeScript/" class="animsition-link">1-TypeScript<small>(3)</small></a></li>
				    
				    <li><a href="/categories/2-React/" class="animsition-link">2-React<small>(10)</small></a></li>
				    
				    <li><a href="/categories/2-React-Hooks/" class="animsition-link">2-React_Hooks<small>(5)</small></a></li>
				    
				    <li><a href="/categories/2-Redux和Router/" class="animsition-link">2-Redux和Router<small>(9)</small></a></li>
				    
				    <li><a href="/categories/2-Vue/" class="animsition-link">2-Vue<small>(12)</small></a></li>
				    
				    <li><a href="/categories/3-Brower/" class="animsition-link">3-Brower<small>(30)</small></a></li>
				    
				    <li><a href="/categories/4-Node/" class="animsition-link">4-Node<small>(1)</small></a></li>
				    
				    <li><a href="/categories/4-Promise/" class="animsition-link">4-Promise<small>(7)</small></a></li>
				    
				    <li><a href="/categories/4-Webpack/" class="animsition-link">4-Webpack<small>(8)</small></a></li>
				    
				    <li><a href="/categories/业务和思想/" class="animsition-link">业务和思想<small>(15)</small></a></li>
				    
				    <li><a href="/categories/前端大项/" class="animsition-link">前端大项<small>(9)</small></a></li>
				    
				    <li><a href="/categories/基础补充/" class="animsition-link">基础补充<small>(5)</small></a></li>
				    
				    <li><a href="/categories/框架差异/" class="animsition-link">框架差异<small>(8)</small></a></li>
				    
				    <li><a href="/categories/算法相关/" class="animsition-link">算法相关<small>(10)</small></a></li>
				    
				    <li><a href="/categories/超脱领悟/" class="animsition-link">超脱领悟<small>(9)</small></a></li>
				    
				    <li><a href="/categories/面试复盘/" class="animsition-link">面试复盘<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">一宿更名_BLOG</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2021-07-10T14:18:33.000Z" itemprop="datePublished">
          2021-07-10
      </time>
    
    
    | 
    <a href='/tags/网络/'>网络</a>,
    
    <a href='/tags/NetWork/'>NetWork</a>
    
    
</span>
                <h1>http报文，请求中断</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h1 id="HTTP请求报文"><a href="#HTTP请求报文" class="headerlink" title="HTTP请求报文"></a>HTTP请求报文</h1><h2 id="请求报文"><a href="#请求报文" class="headerlink" title="请求报文"></a>请求报文</h2><p>一个HTTP请求报文由请求行（request line） 、请求头部（header）、空行和请求数据4个部分组成。</p>
<img src="../assets/请求报文.jpg" style="margin:0 auto">

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /user <span class="variable constant_">HTTP</span>/<span class="number">1.1</span>                       <span class="comment">// 请求行</span></span><br><span class="line"><span class="title class_">Host</span>: www.<span class="property">user</span>.<span class="property">com</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="title class_">Connection</span>: <span class="title class_">Keep</span>-<span class="title class_">Alive</span></span><br><span class="line"><span class="title class_">User</span>-<span class="attr">agent</span>: <span class="title class_">Mozilla</span>/<span class="number">5.0</span>.                  <span class="comment">// 以上是请求头</span></span><br><span class="line">（此处必须有一空行 |                         <span class="comment">// 空行分割header和请求内容 </span></span><br><span class="line">name=world                                <span class="comment">// 请求体(可选，如get请求时可选)</span></span><br></pre></td></tr></table></figure>

<h4 id="1-请求行"><a href="#1-请求行" class="headerlink" title="1. 请求行"></a>1. 请求行</h4><p>请求行由三部分组成：请求方法、请求地址【协议（protocol）、主机（host）、路径（path）、参数（query string）】、版本</p>
<p>HTTP&#x2F;1.1 定义的请求方法有8种：<strong>GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE</strong>,最常的两种GET和POST，如果是RESTful接口的话一般会用到GET、POST、DELETE、PUT。</p>
<h4 id="2-请求头（request-header）"><a href="#2-请求头（request-header）" class="headerlink" title="2. 请求头（request header）"></a>2. 请求头（request header）</h4><ol>
<li><p><mark>Accept（ak赛pt）: 客户端可识别的响应内容类型列表</mark>;星号 “ * ” 用于按范围将类型分组，用 “ <em>&#x2F;</em> ” 指示可接受全部类型，用“ type&#x2F;* ”指示可接受 type 类型的所有子类型</p>
<blockquote>
<ol>
<li>以text开头，text&#x2F; html：HTML格式 ； plain：纯文本格式 ；xml： XML格式</li>
<li>以image开头，image&#x2F; gif ； jpeg ；png</li>
<li>以video开头，video&#x2F; mpeg ； quicktime</li>
</ol>
<p>以上三种直接就可以用；</p>
<ol start="4">
<li>以application开头，需要加工在处理，xhtml+xml &#x2F; atom+xml &#x2F; json（json字符串在解析）&#x2F; pdf &#x2F; word &#x2F; x-www-form-urlencoded。</li>
</ol>
</blockquote>
</li>
<li><p><mark>Accept-encoding: 客户端可接受的编码压缩格式，减少网络流量，提升性能</mark>比如：gzip, deflate, br。</p>
<blockquote>
<ul>
<li>要求而非强制，如果服务器不支持或者未开启压缩，租不起作用。</li>
<li>服务端支持压缩&#x2F;开启压缩，会在响应头中Content-Encoding：gzip标明格式。</li>
</ul>
</blockquote>
</li>
<li><p><mark>Accept-Language：客户端期望&#x2F;支持的返回的语言包</mark>，国际化中有语言包，才可以翻译，否则会显示key（乱码），eg：zh（中文）&#x2F; zh-cn（简体中文） &#x2F; en （英语）、 fr（法语）。利用这个头，做国际站点的切换。</p>
</li>
<li><p><mark>Connection：TCP信道的链接</mark>。keep-alive（1.1之后默认）：客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。close 代表一个Request完成后，客户端和服务器之间用于传输HTTP数据的TCP连接会关闭， 当客户端再次发送Request，需要重新建立TCP连接。</p>
<blockquote>
<p>常见的问题：什么情况下的请求是公用一个TCP链接信道？</p>
<p>标识位置？ connectionId：代表单个请求新建立的信道索引</p>
</blockquote>
</li>
<li><p>cache-control: no-cache（ 响应不会被缓存,而是实时向服务器端请求资源）max-age:(缓存最长有效时间)</p>
</li>
<li><p>cookie:（用户cookie）</p>
</li>
<li><p><mark>referer</mark>: ruai服若 (判断浏览器来自于哪个页面，标识访问路径，网页重定向）</p>
</li>
<li><p><mark>Sec-Fetch-Dest\ Sec-Fetch-Mode \ Sec-Fetch-Site </mark></p>
<blockquote>
<p>a. mode - 请求的模式</p>
<p> cors:跨域请求</p>
<p> no-cors：限制请求</p>
<p> same-origin ：同源请求</p>
<p> navigate：浏览器切换页面行为</p>
<p> websocket：建立websocket链接</p>
<p>b. dset - 如何使用我们获取的数据</p>
<p> empty （通用的）&#x2F; iframe（iframe使用中）&#x2F; image &#x2F; font</p>
<p>c. site - 请求发起者和资源的关系（补充说明）</p>
<p> cross-site ：跨域请求</p>
<p> same-origin： 发起和目标站点一致</p>
<p> none：a标签，直接url输入等等操作。</p>
</blockquote>
</li>
<li><p>If-Modified-Since: 客户端第二次请求此URL时，浏览器会向服务器传送 If-Modified-Since 报头，询问该时间之后文件是否有被修改过.</p>
</li>
<li><p>If-None-Match：同上，效力于etag</p>
</li>
<li><p><mark>user-agent: 用户侧信息</mark>，用于判断 app 环境，安卓，ios 等，使用正则来匹配字符串，投放业务：向不同的 app 放入 h5 页面，用 user-agent 来判断当前所属环境connection： keep-alive (close)长连接或者连一次断开连接。</p>
<blockquote>
<p>内容包含： - 操作系统 &#x2F; 版本、 浏览器 &#x2F; 版本、 设备信息（移动端）&#x2F; 版本8</p>
</blockquote>
</li>
<li><p>Range（用于断点续传，瑞en支）：<strong>Range:bytes&#x3D;0-5</strong> 指定第一个字节的位置和最后一个字节的位置。用于告诉服务器自己想取对象的哪部分。</p>
</li>
<li><p>Content-type:发送端发送的实体数据类型，比如，Content-Type：text&#x2F;html（application&#x2F;json）表示发送的是html类型，<strong>multipart&#x2F;form-data</strong>用以支持向服务器发送二进制数据，以便可以在 POST 请求中实现文件上传等功能</p>
</li>
<li><p>q 参数优先级，</p>
</li>
</ol>
<h4 id="3-请求体"><a href="#3-请求体" class="headerlink" title="3. 请求体"></a>3. 请求体</h4><p>get没有，post有</p>
<h2 id="响应报文"><a href="#响应报文" class="headerlink" title="响应报文"></a>响应报文</h2><p>和请求报文的结构差不多，也是四个部分组成</p>
<h4 id="1-响应行"><a href="#1-响应行" class="headerlink" title="1. 响应行"></a>1. 响应行</h4><p>状态行由三部分组成：<strong>服务器HTTP协议版本</strong>，<strong>响应状态码</strong>，<strong>状态码的文本描述</strong></p>
<p>格式：HTTP-Version Status-Code Reason-Phrase CRLF</p>
<p>比如：HTTP&#x2F;1.1 200 OK</p>
<h4 id="2-响应头（response-header）"><a href="#2-响应头（response-header）" class="headerlink" title="2. 响应头（response header）"></a>2. 响应头（response header）</h4><ol>
<li>content-encoding: gzip 格式压缩</li>
<li>content-type: application&#x2F;json;charset&#x3D;UTF-8(支持的编码，资源类型等等等)</li>
<li>date: Thu, 06 Aug 2020 08:15:05 GMT</li>
<li>set-cookie: 通过 set-cookie，就会被种上 cookie</li>
<li>last-modified:（缓存相关还有etag，请求资源回来后，在下一次请求相同资源的时候if-modified-since会携带改信息）</li>
<li>expires(Aks拜er):（告诉客户端，再某个时间之前，缓存副本是有效的，但是客户端和服务端的时间不一定一致，这个相应头是有问题的）</li>
<li>Connection：keep-alive 这个字段作为回应客户端的Connection：keep-alive，告诉客户端服务器的tcp连接也是一个长连接，客户端可以继续使用这个tcp连接发送http请求。</li>
<li>ETag: “737060cd8c284d8af7ad3082f209582d” 就是一个对象（比如URL）的标志值，就一个对象而言，比如一个html文件，如果被修改了，其Etag也会别修改，所以，ETag的作用跟Last-Modified的作用差不多，主要供WEB服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得了其 ETag，当这次又请求这个文件时，浏览器就会把先前获得ETag值发送给WEB服务器，然后WEB服务器会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变了。</li>
<li>Refresh: 5; url&#x3D;<a target="_blank" rel="noopener" href="http://baidu.com/">http://baidu.com</a> 用于重定向，或者当一个新的资源被创建时。默认会在5秒后刷新重定向。</li>
<li>Access-Control-Allow-Origin: <span style="color:red">* 号代表所有网站可以跨域资源共享，如果当前字段为<em>那么Access-Control-Allow-Credentials就不能为true</span>、若为Access-Control-Allow-Origin: <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></em>* 指定哪些网站可以跨域资源共享</li>
<li>Access-Control-Allow-Methods：GET,POST,PUT,DELETE*允许哪些方法来访问</li>
<li>Access-Control-Allow-Credentials : true是否允许发送cookie。默认情况下，Cookie不包括在CORS请求之中。设为true，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。这个值也只能设为true，如果服务器不要浏览器发送Cookie，删除该字段即可。如果access-control-allow-origin为*，当前字段就不能为true</li>
<li>Content-Range: bytes 0-5&#x2F;7877 指定整个实体中的一部分的插入位置，他也指示了整个实体的长度。在服务器向客户返回一个部分响应，它必须描述响应覆盖的范围和整个实体长度。</li>
</ol>
<h4 id="3-响应实体"><a href="#3-响应实体" class="headerlink" title="3. 响应实体"></a>3. 响应实体</h4><p>​    实体包含了Web客户端请求的对象。Content-Length标头及Content-Type标头用于计算实体的位置、数据类型和数据长度。当Web服务器接收到Web客户端的请求报文后，对HTTP请求报文进行解析，并将Web客户端的请求的对象取出打包，通过HTTP响应报文将数据传回给Web客户端，如果出现错误则返回包含对应错误的错误代码和错误原因的HTTP响应报文。</p>
<h2 id="关于常用的http请求头以及响应头详解：https-juejin-cn-post-6844903745004765198"><a href="#关于常用的http请求头以及响应头详解：https-juejin-cn-post-6844903745004765198" class="headerlink" title="关于常用的http请求头以及响应头详解：https://juejin.cn/post/6844903745004765198"></a>关于常用的http请求头以及响应头详解：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903745004765198">https://juejin.cn/post/6844903745004765198</a></h2><blockquote>
<p>为什么常见的 cdn 域名和业务域名不一样？</p>
<p>1.安全问题，公司不想把用户信息传给 cdn<br>2.cdn request header 会携带 cookie，本来是拉一些静态的代码，不需要 cookie，但是携带了，浪费带宽</p>
</blockquote>
<h1 id="请求中断或者超时请求"><a href="#请求中断或者超时请求" class="headerlink" title="请求中断或者超时请求"></a>请求中断或者超时请求</h1><ol>
<li>实现一个网络请求超时取消的函数封装？setTimeOut&#x2F;或者promise.race</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网络请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">option</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现一个网络请求超时取消的函数;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">requestTimeOutCancel</span>(<span class="params">fn, time</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="string">&quot;网络请求超时，请重试&quot;</span>);</span><br><span class="line">    &#125;, time);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(res);</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">requestTimeOutCancel</span>(request, <span class="number">1000</span>).<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>).<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>补充：如果是 axios 或者 ajax 的话，可以设置超时时间的值<br>eg:axios.timeout&#x3D;5000</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">cancelRequestService</span> = (<span class="params">fn, timeout</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> rejectPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;timeout！&#x27;</span>), timeout)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([rejectPromise, <span class="title function_">fn</span>()]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getData</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(&#123; <span class="attr">res</span>: <span class="string">&#x27;data&#x27;</span> &#125;), <span class="number">2000</span>)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="title function_">cancelRequestService</span>(getData, <span class="number">3000</span>).<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure>

<p>3.网络请求中断；</p>
<h3 id="fetch-的中断"><a href="#fetch-的中断" class="headerlink" title="fetch 的中断"></a>fetch 的中断</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;http://domain/service&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">signal</span>: controller.<span class="property">signal</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">controller.<span class="title function_">abort</span>();</span><br></pre></td></tr></table></figure>

<h3 id="axios-的中断"><a href="#axios-的中断" class="headerlink" title="axios 的中断"></a>axios 的中断</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一</span></span><br><span class="line"><span class="comment">// 使用 CancelToken.source 工厂方法创建一个 cancel token，</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CancelToken</span> = axios.<span class="property">CancelToken</span>;</span><br><span class="line"><span class="keyword">const</span> source = <span class="title class_">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;https://mdn.github&quot;</span> &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: source.<span class="property">token</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 取消请求</span></span><br><span class="line">source.<span class="title function_">cancel</span>(<span class="string">&quot;Operation canceled by the user.&quot;</span>);</span><br><span class="line"><span class="comment">// axios 为我们提供了一个 isCancel() 方法，用于判断请求的中止状态。isCancel() 方法的参数，就是我们在中止请求时自定义的信息。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二</span></span><br><span class="line"><span class="comment">// 通过传递一个 executor 函数到 CancelToken 的构造函数来创建一个 cancel token：</span></span><br><span class="line"><span class="keyword">let</span> cancel;</span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;/user/12345&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: <span class="keyword">new</span> axios.<span class="title class_">CancelToken</span>(<span class="keyword">function</span> <span class="title function_">executor</span>(<span class="params">c</span>) &#123;</span><br><span class="line">    <span class="comment">// executor 函数接收一个 cancel 函数作为参数</span></span><br><span class="line">    cancel = c;</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 取消请求</span></span><br><span class="line"><span class="title function_">cancel</span>(<span class="string">&quot;Operation canceled by the user.&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ajax请求中断"><a href="#ajax请求中断" class="headerlink" title="ajax请求中断"></a>ajax请求中断</h3><p>调用原生的xhr的abort方法，即可中断请求，xhr.abort()</p>
<h3 id="umi-request-中断请求"><a href="#umi-request-中断请求" class="headerlink" title="umi-request 中断请求"></a>umi-request 中断请求</h3><p>umi-request 基于 fetch 封装, 兼具 fetch 与 axios 的特点, 中止请求与 fetch 和 axios</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/%E5%89%8D%E7%AB%AF%E5%A4%A7%E9%A1%B9/JsBridge/" style="float: left;">
        ← JS Bridge
    </a>
    
    
    <a class="pull-right" href="/4-Webpack/chunk%E5%92%8Cbundle/">
        chunk和bundle →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 盛祥玉. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
