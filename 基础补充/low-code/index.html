<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>low-code | 一宿更名_BLOG</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="一宿更名_BLOG">
    <meta name="author" content="盛祥玉">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="一宿更名_BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/1-Css/" class="animsition-link">1-Css<small>(11)</small></a></li>
				    
				    <li><a href="/categories/1-JavaScript/" class="animsition-link">1-JavaScript<small>(14)</small></a></li>
				    
				    <li><a href="/categories/1-TypeScript/" class="animsition-link">1-TypeScript<small>(3)</small></a></li>
				    
				    <li><a href="/categories/2-React/" class="animsition-link">2-React<small>(10)</small></a></li>
				    
				    <li><a href="/categories/2-React-Hooks/" class="animsition-link">2-React_Hooks<small>(5)</small></a></li>
				    
				    <li><a href="/categories/2-Redux和Router/" class="animsition-link">2-Redux和Router<small>(9)</small></a></li>
				    
				    <li><a href="/categories/2-Vue/" class="animsition-link">2-Vue<small>(12)</small></a></li>
				    
				    <li><a href="/categories/3-Brower/" class="animsition-link">3-Brower<small>(30)</small></a></li>
				    
				    <li><a href="/categories/4-Node/" class="animsition-link">4-Node<small>(1)</small></a></li>
				    
				    <li><a href="/categories/4-Promise/" class="animsition-link">4-Promise<small>(7)</small></a></li>
				    
				    <li><a href="/categories/4-Webpack/" class="animsition-link">4-Webpack<small>(8)</small></a></li>
				    
				    <li><a href="/categories/业务和思想/" class="animsition-link">业务和思想<small>(15)</small></a></li>
				    
				    <li><a href="/categories/前端大项/" class="animsition-link">前端大项<small>(9)</small></a></li>
				    
				    <li><a href="/categories/基础补充/" class="animsition-link">基础补充<small>(5)</small></a></li>
				    
				    <li><a href="/categories/框架差异/" class="animsition-link">框架差异<small>(8)</small></a></li>
				    
				    <li><a href="/categories/算法相关/" class="animsition-link">算法相关<small>(10)</small></a></li>
				    
				    <li><a href="/categories/超脱领悟/" class="animsition-link">超脱领悟<small>(9)</small></a></li>
				    
				    <li><a href="/categories/面试复盘/" class="animsition-link">面试复盘<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">一宿更名_BLOG</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2022-07-16T03:37:56.000Z" itemprop="datePublished">
          2022-07-16
      </time>
    
    
    | 
    <a href='/tags/low-code/'>low-code</a>
    
    
</span>
                <h1>low-code</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="low-code理解"><a href="#low-code理解" class="headerlink" title="low-code理解"></a>low-code理解</h2><h5 id="基本意义"><a href="#基本意义" class="headerlink" title="基本意义"></a>基本意义</h5><ul>
<li><strong>全栈可视化编程：</strong>可视化包含两层含义，一个是编辑时支持的点选、拖拽和配置操作，另一个是编辑完成后所及即所得（WYSIWYG）的预览效果。传统代码IDE也支持部分可视化能力（如早年Visual Studio的MFC&#x2F;WPF），但低代码更强调的是全栈、端到端的可视化编程，覆盖一个完整应用开发所涉及的各个技术层面（界面&#x2F;数据&#x2F;逻辑）。</li>
<li><strong>全生命周期管理：</strong>作为一站式的应用开发平台，低代码支持应用的完整生命周期管理，即从设计阶段开始（有些平台还支持更前置的项目与需求管理），历经开发、构建、测试和部署，一直到上线后的各种运维（e.g. 监控报警、应用上下线）和运营（e.g. 数据报表、用户反馈）。</li>
<li><strong>低代码扩展能力：</strong>使用低代码开发时，大部分情况下仍离不开代码，因此平台必须能支持在必要时通过少量的代码对应用各层次进行灵活扩展，比如添加自定义组件、修改主题CSS样式、定制逻辑流动作等。一些可能的需求场景包括：UI样式定制、遗留代码复用、专用的加密算法、非标系统集成。</li>
<li>降本增效</li>
</ul>
<h5 id="整体架构设计"><a href="#整体架构设计" class="headerlink" title="整体架构设计"></a>整体架构设计</h5><p>​    核心使用json（DSL）抽象描述视图，最终搭建出来的产物是一个json文件，导入导出的都json，并且页面的预览使用相应解析的渲染器做渲染。</p>
<h5 id="渲染方式"><a href="#渲染方式" class="headerlink" title="渲染方式"></a>渲染方式</h5><p>​    出码渲染（转化成react源码）和运行时渲染（直接解析，渲染出相应组件）</p>
<blockquote>
<p>记小红书一面：我们的物料是应对n多业务方的，但是业务使用方的产品中，一部分的物料是用不到的，也就是业务方只可能使用到少量的物料，那么这该如何处理呢？</p>
<p>这一定是按需加载的，我们到处的json文件中，是一个树形结构，dfs遍历这棵树，每个节点都有自己的关键子keyword，代表自己是哪个组件库的组件，在运行时渲染，动态和组件库做映射导入，最后再将无用的组件tree sharking掉。来减轻项目多余的物料负担。</p>
</blockquote>
<h5 id="1、物料堆"><a href="#1、物料堆" class="headerlink" title="1、物料堆"></a>1、物料堆</h5><ul>
<li>功能：内置组件和物料市场<ul>
<li>内置组件：标准化组件</li>
<li>物料市场：由外部提供物料组件，给用户扩展能力，提供搜索和导入功能<ul>
<li>对运营来说：选货目标</li>
<li>对开发来说：可提供cli工具（结合CI&#x2F;CD流程）、云编辑器online-edition</li>
<li>CI&#x2F;CD基本流程：<ul>
<li>流程：开发环境、测试、CR(代码审核)、灰度发布、入库</li>
<li>对应环境：dev、test、staging、prod</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>架构师设计：元组件、布局组件、复合组件（元组件+布局组件）<ul>
<li>基础组件：元组件（不可嵌套）、布局组件（可嵌套）</li>
<li>复合组件：由元组件 + 布局组件 + 复合组件组成</li>
</ul>
</li>
<li>开发设计：<ul>
<li>元组件：使用普通组件实现</li>
<li>布局组件：壳slot或vnode，布局使用杉格（grid-layout）或flex布局</li>
</ul>
</li>
</ul>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cfbb633e47fe445cb34e98417d001b2c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="图片.png"></p>
<h5 id="2、主舞台"><a href="#2、主舞台" class="headerlink" title="2、主舞台"></a>2、主舞台</h5><p>1、类别：</p>
<ul>
<li>所见及所得：渲染引擎一体化，优缺点：可探索，复杂度较高，逻辑集成度高；</li>
<li>多态舞台：分为配置舞台和渲染引擎，优缺点：状态分离、效率高、同时两拨人维护，eg：配置使用h5，渲染为小程序后flutter。</li>
</ul>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9a293eb10d34def8c41fb8f596348d4~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="图片.png"> 2、相关思想：</p>
<ul>
<li>微内核思想：操作的是DSL（json树），f(state)-&gt;view<ul>
<li>组合和渲染层隔离</li>
<li>render runtime(渲染引擎sdk) + dsl(json) &#x3D; 页面</li>
</ul>
</li>
<li>事件：DND拖拽、Mouse Event</li>
<li>画布分层技术：借鉴浏览器渲染模型，使用冒泡机制，走到所有层<ul>
<li>第一层：div，负责渲染，render(dsl, document.querySelector(“#root”))</li>
<li>第二层：加一层div，只负责处理右键事件</li>
<li>第三层：加一层div，只处理快捷键</li>
<li>event bus：所有层可通过event bus进行通信</li>
</ul>
</li>
<li>画布功能及拓展：无限画布、引导线（衫格）、吸附对齐、旋转、快捷键、右键、缩放<ul>
<li>无限画布：监听滚动事件，每次给画布加宽带</li>
<li>引导线：使用div画线（高度和宽带为1px）、绝对定位可拖动，下方</li>
<li>吸附对齐：计算想尽的dom节点，定6个点和3个线，距离相近时，设置距离为0</li>
</ul>
</li>
</ul>
<h5 id="3、编辑面板"><a href="#3、编辑面板" class="headerlink" title="3、编辑面板"></a>3、编辑面板</h5><ul>
<li>相同类型使用同一面板，可使用class类</li>
<li>单个类型为实例，config配置挂载至vnode</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae8ea8f026014c8c8158d2db2a2b63fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="图片.png"></p>
<h5 id="4、操作栏目"><a href="#4、操作栏目" class="headerlink" title="4、操作栏目"></a>4、操作栏目</h5><p>操作解耦：进行分层设计，数据、视图、操作解耦</p>
<ul>
<li>功能：撤销、重做、预览、提测、发布<ul>
<li>重做：使用队列，指针移动</li>
<li>预览：render(dsl: {type, key,props{},animate{},actions:{},attrs:{},children[]})</li>
</ul>
</li>
<li>中间层：权限控制、数据操作（转换），暴露部分api</li>
<li>底层：提供plugins、hooks等可扩展的插件机制，可使用：webpack&#x2F;taple</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack/taple, umi/plugins, rollup/plugins</span></span><br><span class="line"><span class="comment">//eg: a.plugin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">a</span> = (<span class="params">dsl = &#123;&#125;, api</span>) =&gt; &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;undo&quot;</span>,</span><br><span class="line">  <span class="attr">label</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="title function_">apply</span>(<span class="params"></span>)&#123;&#125;,</span><br><span class="line">  <span class="title function_">inited</span>(<span class="params"></span>)&#123;&#125;, <span class="comment">//生命周期</span></span><br><span class="line">  <span class="title function_">beforePublish</span>(<span class="params"></span>)&#123;&#125;, </span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//dsl: 树形结构</span></span><br><span class="line"><span class="attr">dsl</span>: &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">animate</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;&#125;, <span class="comment">//逻辑的配置，flow(流程图)</span></span><br><span class="line">  <span class="attr">attrs</span>: &#123;&#125;, <span class="comment">//配置键盘信息</span></span><br><span class="line">  <span class="attr">children</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5、输出"><a href="#5、输出" class="headerlink" title="5、输出"></a>5、输出</h5><ul>
<li>符合语法规范可二次开发的源代码，减少还原ui的工作量，开发人员将导出源码放入工程内补充逻辑部分即可。<ul>
<li>原理：字符串拼接，可使用nodejs后端进行拼接和打包</li>
<li>扩展：在线编辑功能，使用manoco编辑器，预览使用iframe沙箱隔离展示，两者通过postMessage通信</li>
<li>模版保存：使用mongodb数据库存储数据库，mongoose驱动库</li>
</ul>
</li>
<li>导出json文件：render runtime(渲染引擎sdk) + dsl(json) &#x3D; 页面</li>
</ul>
<h5 id="6、扩展功能"><a href="#6、扩展功能" class="headerlink" title="6、扩展功能"></a>6、扩展功能</h5><p>历史记录和版本、模版、权限页面、分享、主题</p>
<p>进阶：协同编辑、定时任务、微前端（集成到其他系统的能力）、混合开发</p>
<ul>
<li>混合开发：组件（ts、flow）和json混合开发</li>
<li>vscode插件：打开可视化面板，拖拽生成代码</li>
<li>逻辑的配置：使用流程图（flow），最后生成业务逻辑</li>
<li>协同编辑：crdt算法使用yjs、ot算法（语雀）</li>
<li>amis：json层级、借鉴原型链实现伪作用域（继承、react的context）</li>
</ul>
<p>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7080445691520090120">https://juejin.cn/post/7080445691520090120</a></p>
<p>参透文章：<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/778493">https://developer.aliyun.com/article/778493</a></p>
<h5 id="1-拖拽实现"><a href="#1-拖拽实现" class="headerlink" title="1. 拖拽实现"></a>1. 拖拽实现</h5><p>​    drog事件是响应拖拽的最核心最合理相应事件，<span style='color:red'>回调函数中的e的offsetY，offsetX 是相对于鼠标放下对于父容器（relative）的位置</span>。 </p>
<p>​    如果是e的client X，clientY属性是相对于document决定相对定位位置。这两个属性数值需要注意</p>
<p>中间的舞台是一个定位容器，我们拖入元素的时候并且放下元素，相应事件，将相应事件的e中的offsetY，offsetX和key的唯一标识，zindex等属性包装成对象push到渲染区中渲染器的block数组中。</p>
<p>​    画布直接遍历渲染元素，根据对应的定位信息和层叠渲染，注意定位都是绝对定位。对于元素的渲染位置，需要偏移自身一半，在正确的位置渲染。</p>
<blockquote>
<p>dragenter进入元素中 添加一个移动的标识</p>
<p>dragover 在目标元素经过 必须要阻止默认行为 否则不能触发drop</p>
<p>dragleave 离开元素的时候 需要增加一个禁用标识</p>
<p>drop 松手的时候 根据拖拽的组件 添加一个组件</p>
</blockquote>
<h5 id="2-画布元素拖拽"><a href="#2-画布元素拖拽" class="headerlink" title="2. 画布元素拖拽"></a>2. 画布元素拖拽</h5><p>​    鼠标移动或者拖拽的api 得到的clientX，clientY都是相对于全屏来说的。</p>
<ol>
<li>移动物体的大致逻辑：单个block物体监听mousedown事件，每次点击物料item，都需要在闭包变量中的记录初始的x，y坐标，<span style='color:red'>同时在document上添加mousemove，mouseup的事件</span></li>
<li>mouseMove事件响应，之后移动元素，获得元素移动后的clientX，clientY（此处为相对document定位）。</li>
<li>所以得出元素的相对移动距离(offsetX &#x3D; clientX-x,offsetY &#x3D; client-Y)</li>
<li>最后元素移动的距离&#x3D;初始化位置，+ （offsetX，offsetY），将构造出来的元素位置样式信息push到渲染去的block数组中。</li>
<li>最后鼠标抬起，响应mouseup事件，移除全部监听事件。</li>
</ol>
<h5 id="3-多选元素，反选元素，整体移动"><a href="#3-多选元素，反选元素，整体移动" class="headerlink" title="3. 多选元素，反选元素，整体移动"></a>3. 多选元素，反选元素，整体移动</h5><p>​    抽离成一个useFouces的函数，传入物料 计算属性维护选中元素数组以及未选中的元素数组，在mousemove事件中，遍选聚焦数组，计算移动属性，如上面一样的逻辑。</p>
<h5 id="4-吸附对齐功能，鼠标移动，找线，找到return出来一个可相应式的line的横纵坐标，由此坐标制作辅助线。"><a href="#4-吸附对齐功能，鼠标移动，找线，找到return出来一个可相应式的line的横纵坐标，由此坐标制作辅助线。" class="headerlink" title="4.吸附对齐功能，鼠标移动，找线，找到return出来一个可相应式的line的横纵坐标，由此坐标制作辅助线。"></a>4.吸附对齐功能，鼠标移动，找线，找到return出来一个可相应式的line的横纵坐标，由此坐标制作辅助线。</h5><p>​    鼠标按下的时候，我们要拿到最后一个拖拽的元素，并且在闭包变量中收集没有选中的元素，并且制造辅助线坐标（x,y）数组，对于每一个任意形状的元素，横向和纵向都需要5条线来展示辅助线，比如说目标元素的左辅助线显示对应着拖拽元素的左线、右线等等。这部分的线的坐标可以通过目标元素的clientHeight、clientwidth和拖拽元素的clientHeight、clientWidth和鼠标移动的坐标可以计算出辅助线的位置坐标</p>
<p>​    所以我们构造一个lines对象，具有x和y的属性，分别对应上述说的辅助线的x，y辅助线数组。而每个辅助线数组，又需要一个对象来映射关系，拖拽元素出现的位置和目标元素辅助线出现位置（top或者left）。</p>
<p>​    鼠标移动的时候，获得鼠标移动的clientX,clientY，遍历收集的lines的x数组和y数组进行对比，当鼠标的移动的横纵坐标和我们预先构造的横纵坐标绝对值之差小于小于5的时候，break，跳出循环。拿到对应的top和left值，得出markline的定位信息返回，在渲染区上的每一个block元素，后面添加渲染辅助线。正常判空，如果是空，就不渲染辅助线。当return出值的时候，渲染辅助线。</p>
<p>​    鼠标抬起的时候，将线置空。</p>
<h5 id="5-撤销重做"><a href="#5-撤销重做" class="headerlink" title="5.撤销重做"></a>5.撤销重做</h5><p>​    撤销和重做的动作禁止添加新纪录，构造useCommand钩子，返回command对象，命令模式构造command行为动作。整体使用发布订阅和命令模式完成，维护历史栈中的快照信息（使用每一个item的undo、redo的闭包函数）</p>
<p>​    用户的每一次操作都需要形成物料快照，在用户移动物料或者从原料库中拖拽物料的时候，对于事件响应记录快照，使用发布订阅来做，在对应的拖拽开始的时候emit出去事件，记录一下快照（before状态），有效拖拽drag事件结束（记录一下after状态），同时改变指针的current索引，让历史栈响应事件记录当前json数据的位置和样式，同时移动指针。</p>
<p>​    对于撤销或者重做，还有一些别的操作（比如置顶，置底、导入json数据等等），将所有的逻辑封装成一个command对象，命令模式实现这些功能。我们每一次点击撤销或者重做的时候，移动历史栈指针，渲染json数据。</p>
<p>​    画布中物料拖拽的逻辑：默认初始化，记录当前的状态before为空画布，当我们开始拖拽元素并且放下的时候，记录当前的物料的json信息，鼠标放下，记录当前的物料信息。每次操作都会在一个历史操作栈中添加撤销或者重做的函数。</p>
<p>​    每一次有意义的拖拽，都会记录，会向历史栈中不断的push{redo,undo} 对象，每一次操作都是一次独立的闭包，在不断的给历史栈中push撤销和重做的方法，历史操作栈会越来越长（<strong>问题1</strong>），如何解决？</p>
<p>​    在动作（拖拽）触发结束之后，前后两张快照json做一个diff（一个递归函数，判断diff），将diff放入diff历史栈，移动指针的时候，diff出current json数据，渲染视图。</p>
<h5 id="6-嵌套组件："><a href="#6-嵌套组件：" class="headerlink" title="6. 嵌套组件："></a>6. 嵌套组件：</h5><p>父组件使用珊格布局来做，计了一套<code>栅格布局</code>样式，和开发可以自定义设计样式的属性，在父组件上暴露出一些接口，比如珊格的行列数目，通过props传入的方式来控制，还可以有一些label的宽度来适配它，子组件拖进入，自动布局渲染。</p>
<p>对于内部单个组件来说，是否希望单个组件拥有表单的所有状态，是否可以所有的组件单独引用也可以达到使用最外层容器的效果，是要考虑到的。</p>
<p>对于单个组件来说，这些都是不可缺少的。</p>
<ul>
<li><code>校验规则</code>肯定是不可缺少的一环</li>
<li>每个组件也应该拥有自己唯一的<code>key</code>值。</li>
<li>回填值的能力</li>
<li>单个组件的属性管理</li>
<li>具有数据源的组件要如何设计</li>
</ul>
<h3 id="物料堆"><a href="#物料堆" class="headerlink" title="物料堆"></a>物料堆</h3><h4 id="1-形态"><a href="#1-形态" class="headerlink" title="1. 形态"></a>1. 形态</h4><ol>
<li>直联：更加粒度化，比如 form form-item input</li>
<li>整合：form-input</li>
</ol>
<h4 id="2-特点"><a href="#2-特点" class="headerlink" title="2. 特点"></a>2. 特点</h4><ol>
<li>业务解耦，一定是原子形态的物料，无感知的热装载（添加之后，不需要任何其他的操作）</li>
</ol>
<h3 id="系统一致性规范（交互、UI、逻辑）——原子逻辑"><a href="#系统一致性规范（交互、UI、逻辑）——原子逻辑" class="headerlink" title="系统一致性规范（交互、UI、逻辑）——原子逻辑"></a>系统一致性规范（交互、UI、逻辑）——原子逻辑</h3><h3 id="开发投入中的流程"><a href="#开发投入中的流程" class="headerlink" title="开发投入中的流程"></a>开发投入中的流程</h3><p>0投入或者弱投入，主要做组件和平台的维护。</p>
<p>专门为低代码设计适配器方案，外界上传物料堆，每一个物料会有一个对应的适配器，来适配低代码</p>
<p>低代码平台思维设计&amp;基础实现：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7080445691520090120#heading-12">https://juejin.cn/post/7080445691520090120#heading-12</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/1-JavaScript/%E9%A2%84%E7%BC%96%E8%AF%91/" style="float: left;">
        ← 预编译
    </a>
    
    
    <a class="pull-right" href="/3-Brower/%E5%86%85%E6%A0%B8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6/">
        内核渲染机制 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 盛祥玉. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/Yxgm" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
